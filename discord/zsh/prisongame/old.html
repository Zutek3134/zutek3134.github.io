<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTML Meta Tags -->
    <title>Prison Game | Zutek‚Äôs Secret Hideout</title>
    <link rel="icon" type="image/x-icon" href="/images/zeeb.png">
    <meta name="description" content="Prison Game is the annual server event in ZSH since 2021.">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://zutek3134.taipei/discord/zsh/prisongame.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Prison Game | Zutek‚Äôs Secret Hideout">
    <meta property="og:description" content="Prison Game is the annual server event in ZSH since 2021.">
    <meta property="og:image" content="">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="zutek3134.taipei">
    <meta property="twitter:url" content="https://zutek3134.taipei/discord/zsh/prisongame.html">
    <meta name="twitter:title" content="Prison Game | Zutek‚Äôs Secret Hideout">
    <meta name="twitter:description" content="Prison Game is the annual server event in ZSH since 2021.">
    <meta name="twitter:image" content="">


    <link rel="stylesheet" href="discord-styles.css">
    <style>
        :root {
            --lang-en: inherit;
            --lang-zhTw: none;
            --lang-zhCn: none;
            --lang-vi: none;
        }

        body {
            color: white;
        }

        .hidden {
            display: none;
        }

        .member-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .member-item {
            display: grid;
            align-items: center;
            grid-template-columns: 73px 1fr 1fr;
            background: #23272a;
            border: 1px solid #36393f;
            border-radius: 8px;
            margin: 10px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .medal-column {
            grid-template-columns: 73px 4fr 1fr 1fr 1fr 1fr;
        }

        .profile-img-container {
            position: relative;
            display: inline-block;
            width: 70px;
            height: 60px;
        }

        .profile-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            -webkit-mask-image: radial-gradient(circle 15px at 56px 50px, #0000 98%, #000);
            mask-image: radial-gradient(circle 15px at 56px 50px, #0000 98%, #000);
        }

            .profile-img.no-cutout {
                mask-image: none;
            }

        .flag-img {
            position: absolute;
            bottom: 0;
            right: 4px;
            width: 20px;
            height: auto;
            border-radius: 50%;
            background-color: #23272a;
            overflow: hidden;
            z-index: 1;
        }

        .member-info {
            display: flex;
            flex-direction: column;
        }

        .username {
            font-weight: bold;
        }

        .short-username {
            display: none;
        }

        .user-id {
            font-family: 'Noto Sans Mono', monospace;
            font-size: 70%;
            opacity: 0.5;
            line-break: anywhere;
        }

        .notes {
            display: block;
            width: 100%;
            text-align: right;
            opacity: 0.5;
            font-size: 70%;
        }

        [lang=en] {
            display: var(--lang-en);
        }

        [lang=zhTw] {
            display: var(--lang-zhTw);
        }

        [lang=zhCn] {
            display: var(--lang-zhCn);
        }

        [lang=vi] {
            display: var(--lang-vi);
        }

        .gold-border, .silver-border, .bronze-border, .sports-border {
            border: 1px solid;
        }

        .gold-border {
            border-color: gold;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            background: linear-gradient(135deg, #23272a, #6f5d0e);
        }

        .silver-border {
            border-color: silver;
            box-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
            background: linear-gradient(135deg, #23272a, #525e7d);
        }

        .bronze-border {
            border-color: orange;
            box-shadow: 0 0 10px rgba(205, 127, 50, 0.5);
            background: linear-gradient(135deg, #23272a, #815512);
        }

        .sports-border {
            border-color: khaki;
            box-shadow: 0 0 10px #47483e;
            background: linear-gradient(135deg, #23272a, #635f41);
        }

        .container-grid {
            display: flex;
            gap: 20px;
            margin: 0 auto;
            overflow-x: auto;
            height: auto;
        }

        .grid-item {
            position: relative;
            background: #23272a;
            border: 1px solid #36393f;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: 0.3s ease;
            min-width: 40%;
        }

            .grid-item .year {
                width: 100%;
                text-align: center;
                opacity: 0.5;
                font-size: 70%;
                margin-bottom: 2em;
            }

            .grid-item .profile-img {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                margin-bottom: 15px;
                border: 1px solid gold;
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
                mask-image: none;
            }

            .grid-item .flag-img {
                bottom: 0;
                right: 0;
                top: 10px;
                left: 10px;
                width: 40px;
                border: none;
                background-color: transparent;
                overflow: hidden;
                z-index: 1;
            }

        .medal {
            font-weight: 700;
            text-align: right;
            text-align: center;
        }

            .medal.zero {
                font-weight: 300;
                opacity: 0.5;
            }

        .tabs {
            display: flex;
            justify-content: center;
            margin: 20px;
        }

        .tab-button, .tab-toggle {
            padding: 10px 20px;
            border: 3px solid #5865f2;
            background-color: #36393f;
            color: #5865f2;
            cursor: pointer;
            transition: 0.3s;
            font-family: inherit;
            font-weight: 700;
        }

        .tab-toggle {
            color: #57F287;
            border-color: #57F287;
        }

        .tab-button.active {
            background-color: #5865f2;
            color: #36393f;
        }

        .tab-toggle.active {
            background-color: #57F287;
            color: #36393f;
        }

        .loader {
            width: 100%;
            font-weight: bold;
            font-size: 2em;
            text-align: center;
            color: #FEE75C;
            animation: l25 1s infinite;
        }

            .loader::before {
                content: "LOADING...";
            }

        @keyframes l25 {
            0%,12.5% {
                transform: translate(10px,0)
            }

            13%,25% {
                transform: translate(4px,-4px)
            }

            26%,37.5% {
                transform: translate(2px,8px)
            }

            38%,50% {
                transform: translate(12px,-6px)
            }

            51%,62.5% {
                transform: translate(0,12px)
            }

            63%,75% {
                transform: translate(-8px,-4px)
            }

            76%,86.5% {
                transform: translate(-12px,6px)
            }

            87%,100% {
                transform: translate(6px,0)
            }
        }

        /* Display short username and hide full username on small screens */
        @media (max-width: 600px) {
            .full-username {
                display: none;
            }

            .short-username {
                display: inline;
            }

            .user-id {
                font-size: 60%;
            }

            .profile-img-container {
                width: 50px;
                height: 40px;
            }

            .profile-img {
                width: 40px;
                height: 40px;
                -webkit-mask-image: radial-gradient(circle 11px at 37px 32.5px, #0000 98%, #000);
                mask-image: radial-gradient(circle 11px at 37px 32.5px, #0000 98%, #000)
            }

            .flag-img {
                bottom: 0;
                right: 5px;
                width: 15px;
            }

            .member-item {
                grid-template-columns: 50px 1fr 1fr;
            }

            .medal-column {
                grid-template-columns: 50px 2fr 1fr 1fr 1fr 1fr;
            }

            .container-grid {
                gap: 10px;
            }

            .grid-item .profile-img {
                width: 70px;
                height: 70px;
                margin-bottom: 10px;
            }

            .grid-item .flag-img {
                width: 25px;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="breadcrumbs">
            <span id="page"><a href="/">Compass</a></span>
            <span> &gt; </span>
            <span id="page"><a href="/discord">Discord</a></span>
            <span> &gt; </span>
            <span id="page"><a href="index.html">Home</a></span>
            <span> &gt; </span>
            <span><strong>Prison Game</strong></span>
        </div>

        <div class="language-switch">
            <select id="year-select">
                <option value="2024" selected>2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
            </select>
            <select id="language-select">
                <option value="en">English</option>
                <option value="zhTW">Ê≠£È´î‰∏≠Êñá</option>
                <option value="zhCN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                <option value="vi">Ti·∫øng Vi·ªát</option>
            </select>
        </div>
    </nav>

    <h1 id="pgm-title"></h1>

    <div class="container">
        <ul id="pgm-list" class="member-list">
            <div class="loader"></div>
        </ul>
    </div>

    <div id="PGS" style="display: none">
        <h1 id="pgs-title"></h1>
        <div class="container">
            <ul id="pgs-list" class="member-list">
                <div class="loader"></div>
            </ul>
        </div>
    </div>

    <h1 id="prevwin-title">Previous Winners</h1>
    <div class="container">
        <div id="winners-grid" class="container-grid">
            <div class="loader"></div>
        </div>
    </div>

    <h1 id="medal-table-title">Medal Table</h1>
    <p id="medal-table-desc" style="color: #23272a; text-align: center; margin: -2.5em 10px 0 10px">Calculated using the <strong>Exponential Weighted Point System</strong> (8:4:2:1).</p>
    <div class="tabs">
        <button class="tab-button active" id="mtb-member" onclick="switchView('members')" style="border-right-width: 0;">Members</button>
        <button class="tab-button" id="mtb-region" onclick="switchView('countries')" style="border-left-width: 0;">Regions</button>
        <button class="tab-toggle" id="mtb-all" onclick="switchShowAll()" style="margin-left: 1em">All</button>
    </div>
    <div class="container">
        <ul class="member-list">
            <li class="member-item medal-column" style="background: inherit; border: none; box-shadow: none; margin-top: 0;">
                <div></div>
                <div><span class="username full-username"></span><span class="username short-username"></span><span class="user-id"></span></div>
                <div class="medal">ü•á</div>
                <div class="medal">ü•à</div>
                <div class="medal">ü•â</div>
                <div class="medal">üèÖ</div>
            </li>
        </ul>
        <ul id="medal-list" class="member-list">
            <div class="loader"></div>
        </ul>
    </div>

    <script src="common.js"></script>
    <script>// h
        window.localisationData = [
            {
                classId: "prevwin-title",
                text: {
                    en: "Previous Winners",
                    zhTW: "Ê≠∑Â±ÜÂÜ†Ëªç",
                    zhCN: "ÂéÜÂ±äÂÜ†ÂÜõ",
                    vi: "C√°c Nh√† V√¥ ƒê·ªãch Tr∆∞·ªõc ƒê√¢y"
                }
            },
            {
                classId: "medal-table-title",
                text: {
                    en: "Medal Table",
                    zhTW: "ÁçéÁâåÊ¶ú",
                    zhCN: "Â•ñÁâåÊ¶ú",
                    vi: "B·∫£ng X·∫øp H·∫°ng Huy Ch∆∞∆°ng"
                }
            },
            {
                classId: "medal-table-desc",
                text: {
                    en: "Calculated using the <strong>Exponential Weighted Point System</strong> (8:4:2:1).",
                    zhTW: "ÊéíÂ∫è‰æùÊìö<strong>„ÄåÊåáÊï∏ÈôçÂÜ™Âä†Ê¨äÈªûÂ∫è„Äç</strong>Ôºà8:4:2:1ÔºâÊéíÂàó„ÄÇ",
                    zhCN: "‰ΩøÁî® <strong>‚ÄúÊåáÊï∞ÈôçÂπÇÂä†ÊùÉÁÇπÂ∫è‚Äù</strong>Ôºà8:4:2:1ÔºâËÆ°ÁÆóÊéíË°å„ÄÇ",
                    vi: "T√≠nh to√°n b·∫±ng c√°ch s·ª≠ d·ª•ng <strong>H·ªá th·ªëng ƒëi·ªÉm s·ªë c√≥ tr·ªçng s·ªë theo h√†m s·ªë m≈©</strong> (8:4:2:1)."
                }
            },
            {
                classId: "mtb-member",
                text: {
                    en: "Member",
                    zhTW: "ÊàêÂì°",
                    zhCN: "ÊàêÂëò",
                    vi: "Th√†nh Vi√™n"
                }
            },
            {
                classId: "mtb-region",
                text: {
                    en: "Region",
                    zhTW: "Âú∞Âüü",
                    zhCN: "Âú∞Âå∫",
                    vi: "Khu V·ª±c"
                }
            },
            {
                classId: "mtb-all",
                text: {
                    en: "All",
                    zhTW: "ÂÖ®",
                    zhCN: "ÊòæÁ§∫ÂÖ®ÈÉ®",
                    vi: "T·∫•t C·∫£"
                }
            }
        ];

        const membersData = {
            "THR": {
                "country": "th",
                "uid": "848175801554698240",
                "medals": {
                    "goldMedals": 3,
                    "silverMedals": 0,
                    "bronzeMedals": 0,
                    "sportsMedals": 0,
                }
            },
            "HRB": {
                "country": "vn",
                "uid": "395526060956975104",
                "medals": {
                    "goldMedals": 1,
                    "silverMedals": 0,
                    "bronzeMedals": 0,
                    "sportsMedals": 0,
                }
            },
            "DLM": {
                "country": "ph",
                "uid": "583082097791729693",
                "medals": {
                    "goldMedals": 0,
                    "silverMedals": 2,
                    "bronzeMedals": 2,
                    "sportsMedals": 0,
                }
            },
            "TJV": {
                "country": "id",
                "uid": "800263908787093524",
                "medals": {
                    "goldMedals": 0,
                    "silverMedals": 1,
                    "bronzeMedals": 1,
                    "sportsMedals": 0,
                }
            },
            "ZKT": {
                "country": "my",
                "uid": "1009633546685653094",
                "medals": {
                    "goldMedals": 0,
                    "silverMedals": 1,
                    "bronzeMedals": 0,
                    "sportsMedals": 0,
                }
            },
            "DRM": {
                "country": "id",
                "uid": "745292950849978398",
                "medals": {
                    "goldMedals": 0,
                    "silverMedals": 0,
                    "bronzeMedals": 1,
                    "sportsMedals": 0,
                }
            },
            "CYS": {
                "country": "tw",
                "uid": "894152793093468170",
            },
            "CMT": {
                "country": "tw",
                "uid": "584553598432837662",
            },
            "ZTK": {
                "country": "tw",
                "uid": "412951165324754974",
            },
            "MFT": {
                "country": "id",
                "uid": "845069028165943308",
            },
            "PFF": {
                "country": "vn",
                "uid": "850549328426434590",
            },
            "SPB": {
                "country": "ru",
                "uid": "967502390968332378",
            },
            "FTD": {
                "country": "vn",
                "uid": "1159659149404147762",
            },
            "JRR": {
                "country": "vn",
                "uid": "675658750950113280",
            },
            "PJY": {
                "country": "ph",
                "uid": "909754062789021706",
            },
            "TPF": {
                "country": "vn",
                "uid": "853220729998934056",
            },
            "ALX": {
                "country": "hk",
                "uid": "1000927151199105105",
            },
            "IDK": {
                "country": "xx",
                "uid": "idk",
            }
        };

        const countriesData = {
            "xx": {
                "name": "Unknown",
                "a3": "IDK",
                "official": "Region Unknown",
            },
            "cn": {
                "name": "Communist Mainland of ROC",
                "a3": "CCP",
                "official": "ÂÖ±‰∫ß‰∏≠ÂõΩ",
            },
            "hk": {
                "name": "Hong Kong SAR",
                "a3": "HKG",
                "official": "È¶ôÊ∏ØÁâπÂà•Ë°åÊîøÂçÄ",
            },
            "id": {
                "name": "Indonesia",
                "a3": "IDN",
                "official": "Indonesia",
            },
            "my": {
                "name": "Malaysia",
                "a3": "MYS",
                "official": "È©¨Êù•Ë•ø‰∫ö",
            },
            "ph": {
                "name": "Philippines",
                "a3": "PHL",
                "official": "Pilipinas",
            },
            "ru": {
                "name": "Russia",
                "a3": "RUS",
                "official": "–†–æ—Å—Å–∏—è",
            },
            "th": {
                "name": "Thailand",
                "a3": "THA",
                "official": "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢",
            },
            "tw": {
                "name": "Republic of China",
                "a3": "ROC",
                "official": "‰∏≠ËèØÊ∞ëÂúã",
            },
            "vn": {
                "name": "Vietnam",
                "a3": "VNM",
                "official": "Vi·ªát Nam",
            },
        };

        const yearsData = {
            "2024": {
                "main": [
                    {
                        "member": "HRB",
                        "notes": "no1"
                    },
                    {
                        "member": "ZKT",
                        "notes": "out",
                        "param": 4
                    },
                    {
                        "member": "DLM",
                        "notes": "again"
                    },
                    {
                        "member": "TJV",
                        "notes": "afk"
                    },
                    {
                        "member": "DRM",
                        "notes": "out",
                        "param": 3
                    },
                    {
                        "member": "MFT",
                        "notes": "out",
                        "param": 1
                    },
                    {
                        "member": "PFF",
                        "notes": "nope"
                    },
                    {
                        "member": "SPB",
                        "notes": "nope"
                    },
                    {
                        "member": "FTD",
                        "notes": "nope"
                    }
                ],
                "sus": [
                    {
                        "member": "IDK",
                        "notes": "Putt Party"
                    },
                    {
                        "member": "IDK",
                        "notes": "Goober Dash"
                    },
                    {
                        "member": "IDK",
                        "notes": "Typeracer"
                    },
                    {
                        "member": "IDK",
                        "notes": "Country Guess"
                    },
                    {
                        "member": "IDK",
                        "notes": "Flag Guess"
                    },
                    {
                        "member": "IDK",
                        "notes": "Capital Guess"
                    },
                ]
            },
            "2023": {
                "main": [
                    {
                        "member": "THR",
                        "notes": "no1"
                    },
                    {
                        "member": "DLM",
                        "notes": "out",
                        "param": 5
                    },
                    {
                        "member": "DRM",
                        "notes": "out",
                        "param": 5
                    },
                    {
                        "member": "PFF",
                        "notes": "out",
                        "param": 5
                    },
                    {
                        "member": "MFT",
                        "notes": "out",
                        "param": 1
                    },
                    {
                        "member": "SPB",
                        "notes": "nope"
                    },
                    {
                        "member": "PJY",
                        "notes": "nope"
                    }
                ],
            },
            "2022": {
                "main": [
                    {
                        "member": "THR",
                        "notes": "no1"
                    },
                    {
                        "member": "DLM",
                        "notes": "no2"
                    },
                    {
                        "member": "TJV",
                        "notes": "no3"
                    },
                    {
                        "member": "MFT",
                        "notes": "bye"
                    },
                    {
                        "member": "PJY",
                        "notes": "nope"
                    }
                ],
            },
            "2021": {
                "main": [
                    {
                        "member": "THR",
                        "notes": "comp"
                    },
                    {
                        "member": "TJV",
                        "notes": "comp"
                    },
                    {
                        "member": "DLM",
                        "notes": "comp"
                    },
                    {
                        "member": "TPF",
                        "notes": "comp"
                    },
                    {
                        "member": "PFF",
                        "notes": "pause"
                    },
                    {
                        "member": "ALX",
                        "notes": "fail"
                    },
                    {
                        "member": "MFT",
                        "notes": "fail"
                    },
                    {
                        "member": "PJY",
                        "notes": "fail"
                    }
                ]
            }
        };

        function readTheNotes(note, param) {
            const notesDiv = document.createElement('div');
            let en = "";
            let zhTw = "";
            let zhCn = "";
            let vi = ""

            if (note === 'no1') {
                en = "Champion";
                zhTw = "ÂÜ†Ëªç";
                zhCn = "ÂÜ†ÂÜõ";
                vi = "Nh√† v√¥ ƒë·ªãch";
            } else if (note === 'no2') {
                en = "1st Runner-Up";
                zhTw = "‰∫ûËªç";
                zhCn = "‰∫öÂÜõ";
                vi = "Gi·∫£i nh√¨";
            } else if (note === 'no3') {
                en = "2nd Runner-Up";
                zhTw = "Â≠£Ëªç";
                zhCn = "Â≠£ÂÜõ";
                vi = "Gi·∫£i ba";
            } else if (note === 'out') {
                en = `Eliminated in Round ${param}`;
                zhTw = `Ê∑òÊ±∞ÊñºÁ¨¨ ${param} Ëº™`;
                zhCn = `Á¨¨ ${param} ËΩÆÊ∑òÊ±∞`;
                vi = `B·ªã lo·∫°i ·ªü v√≤ng ${param}`;
            } else if (note === 'again') {
                en = `Rep√™chage`;
                zhTw = `Âæ©Ê¥ªË≥Ω`;
                zhCn = `Â§çÊ¥ªËµõ`;
                vi = `V√≤ng lo·∫°i ph·ª•`;
            } else if (note === 'comp') {
                en = `Completed Challenge`;
                zhTw = `ÂÆåÊàêÊåëÊà∞`;
                zhCn = `ÂÆåÊàêÊåëÊàò`;
                vi = "Ho√†n th√†nh th·ª≠ th√°ch";
            } else if (note === 'fail') {
                en = `Failed`;
                zhTw = `Â§±Êïó`;
                zhCn = `Â§±Ë¥•`;
                vi = "Th·∫•t b·∫°i";
            } else if (note === 'pause') {
                en = `Suspended`;
                zhTw = `Âãí‰ª§ÂÅúË≥Ω`;
                zhCn = `Âº∫Âà∂ÊöÇÂÅú`;
                vi = "B·ªã ƒë√¨nh ch·ªâ";
            } else if (note === 'bye') {
                en = `Quitted`;
                zhTw = `‰∏≠ÈÄîÊ£ÑË≥Ω`;
                zhCn = `ÈÄÄÂá∫`;
                vi = "B·ªè cu·ªôc";
            } else if (note === 'afk') {
                en = `Eliminated for Inactivity`;
                zhTw = `Ë≥Ω‰∏≠Èõ¢Â∏≠ËÄåÊ∑òÊ±∞`;
                zhCn = `Âõ†Èó≤ÁΩÆËÄåÊ∑òÊ±∞`;
                vi = "B·ªã lo·∫°i v√¨ kh√¥ng ho·∫°t ƒë·ªông";
            } else if (note === 'nope') {
                en = `Did Not Show Up`;
                zhTw = `Êú™Ê∫ñÊôÇÂá∫Â∏≠`;
                zhCn = `Ê≤°ÊúâÂá∫Áé∞`;
                vi = "Kh√¥ng xu·∫•t hi·ªán";
            } else {
                notesDiv.appendChild(translateTheNotes(null, note));
                return notesDiv;
            }

            notesDiv.appendChild(translateTheNotes('en', en));
            notesDiv.appendChild(translateTheNotes('zhTw', zhTw));
            notesDiv.appendChild(translateTheNotes('zhCn', zhCn));
            notesDiv.appendChild(translateTheNotes('vi', vi));

            return notesDiv;
        }

        function translateTheNotes(lang, string) {
            const notesSpan = document.createElement('span');
            notesSpan.className = `notes`;
            if (lang) notesSpan.lang = lang;
            notesSpan.innerHTML = string;
            return notesSpan;
        }

        async function fetchDiscordProfile(uid) {
            const apiUrl = `https://avatar-cyan.vercel.app/api/${uid}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching the API data:', error);
                return null;
            }
        }

        async function generateMemberProfiles() {
            const profilePromises = Object.keys(membersData).map(async memberId => {
                const member = membersData[memberId];
                const defaultPfp = `images/pfp/default.jpg`;

                if (member.uid === 'idk') {
                    member.username = 'it-might-be-you';
                    member.displayName = 'Coming Soon';
                    member.pfp = defaultPfp;
                } else {
                    const fetchedData = await fetchDiscordProfile(member.uid);

                    if (fetchedData) {
                        member.username = fetchedData.avatarUrl.username;
                        member.displayName = fetchedData.avatarUrl.display_name;
                        member.pfp = fetchedData.avatarUrl.avatarUrl;
                    } else {
                        member.username = '_@ Internet Issues';
                        member.displayName = memberId;
                        member.pfp = defaultPfp;
                    }
                }
            });

            await Promise.all(profilePromises);

            discordApiDoneLoading();
        }

        function createListItem(entry, member, memberId) {
            const listItem = document.createElement('li');
            listItem.className = 'member-item';

            const imgContainer = createPfpContainer(member.pfp, memberId, member.country);
            const infoDiv = createMemberInfoDiv(member.displayName, memberId, member.username);

            listItem.appendChild(imgContainer);
            listItem.appendChild(infoDiv);
            listItem.appendChild(readTheNotes(entry.notes, entry.param));

            return listItem;
        }

        function createPfpContainer(source, id, country) {
            const imgContainer = document.createElement('div');
            imgContainer.className = 'profile-img-container';

            const img = document.createElement('img');
            img.src = source;
            img.alt = id;
            img.className = 'profile-img';

            const flagImg = document.createElement('img');
            flagImg.src = generateFlagIcon(country);
            flagImg.alt = country;
            flagImg.className = 'flag-img';

            imgContainer.appendChild(img);
            imgContainer.appendChild(flagImg);

            return imgContainer;
        }

        function createMemberInfoDiv(displayName, id, username) {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'member-info';

            const usernameLongSpan = document.createElement('span');
            usernameLongSpan.className = 'username full-username';
            usernameLongSpan.textContent = displayName;

            const usernameShortSpan = document.createElement('span');
            usernameShortSpan.className = 'username short-username';
            usernameShortSpan.textContent = id;

            const userIdSpan = document.createElement('span');
            userIdSpan.className = 'user-id';
            userIdSpan.textContent = `@${username}`;

            infoDiv.appendChild(usernameLongSpan);
            infoDiv.appendChild(usernameShortSpan);
            infoDiv.appendChild(userIdSpan);

            return infoDiv;
        }

        function generateFlagIcon(code) {
            if (code === 'tw')
                return `https://hatscripts.github.io/circle-flags/flags/tw.svg`;
            else if (code === 'cn')
                return `/images/others/ccp-flag.png`;

            return `https://kapowaz.github.io/circle-flags/flags/${code}.svg`;
        }

        function loadPgmList(curYearData) {
            const memberList = document.getElementById('pgm-list');
            memberList.innerHTML = '';

            curYearData.main.forEach((entry, index) => {
                const memberId = entry.member;
                const member = membersData[memberId];
                if (!member) return;

                listItem = createListItem(entry, member, memberId)

                if (index === 0) {
                    listItem.classList.add('gold-border');
                } else if (index === 1) {
                    listItem.classList.add('silver-border');
                } else if (index === 2) {
                    listItem.classList.add('bronze-border');
                }

                memberList.appendChild(listItem);
            });

            if (curYearData.sus) loadPgsList(curYearData);
            document.getElementById('PGS').style.display = curYearData.sus ? 'block' : 'none';
        }

        function loadPgsList(curYearData) {
            const memberList = document.getElementById('pgs-list');
            memberList.innerHTML = '';

            curYearData.sus.forEach((entry) => {
                //const titlediv = document.createElement('div');
                //titlediv.className = 'category';
                //memberList.appendChild(titlediv);

                //const title = document.createElement('h2');
                //title.textContent = entry.notes;
                //titlediv.appendChild(title);

                const memberId = entry.member;
                const member = membersData[memberId];
                if (!member) return;

                const listItem = document.createElement('li');
                listItem.className = 'member-item';

                const imgContainer = createPfpContainer(member.pfp, memberId, member.country);
                const infoDiv = createMemberInfoDiv(member.displayName, memberId, member.username);

                listItem.appendChild(imgContainer);
                listItem.appendChild(infoDiv);

                const notesDiv = document.createElement('div');
                notesDiv.className = 'notes';
                notesDiv.textContent = entry.notes;

                listItem.appendChild(notesDiv);
                memberList.appendChild(listItem);
            });
        }

        function loadWinners() {
            const winnersContainer = document.getElementById('winners-grid');
            winnersContainer.innerHTML = '';

            const winnersRaw = {};
            const winners = [];

            for (const year in yearsData) {
                if (yearsData[year].main && yearsData[year].main.length > 0) {
                    winnersRaw[year] = yearsData[year].main[0].member;
                    winners.push(year);
                }
            }

            winners.reverse();

            for (const year of winners) {
                const member = membersData[winnersRaw[year]];

                const gridItem = document.createElement('div');
                gridItem.className = 'grid-item';

                const yearDiv = document.createElement('div');
                yearDiv.className = 'year';
                yearDiv.textContent = year;

                const img = document.createElement('img');
                img.src = member.pfp;
                img.alt = 'Profile Image';
                img.className = 'profile-img';

                const flagImg = document.createElement('img');
                flagImg.src = generateFlagIcon(member.country);
                flagImg.alt = 'Country Flag';
                flagImg.className = 'flag-img';

                const infoDiv = createMemberInfoDiv(member.displayName + ', ' + countriesData[member.country].name, winnersRaw[year] + ', ' + countriesData[member.country].a3, member.username);

                gridItem.appendChild(yearDiv);
                gridItem.appendChild(img);
                gridItem.appendChild(flagImg);
                gridItem.appendChild(infoDiv);

                winnersContainer.appendChild(gridItem);
            }
        }

        function calculateCountryMedals() {
            const countryMedalsData = {};

            Object.values(membersData).forEach(member => {
                if (member.uid === 'idk') return;

                const medals = member.medals || { goldMedals: 0, silverMedals: 0, bronzeMedals: 0, sportsMedals: 0 };
                const country = member.country;

                if (!countryMedalsData[country]) {
                    countryMedalsData[country] = {
                        countryName: countriesData[country].name,
                        countryNameShort: countriesData[country].a3,
                        countryNative: countriesData[country].official,
                        flagImage: generateFlagIcon(country),
                        goldMedals: 0,
                        silverMedals: 0,
                        bronzeMedals: 0,
                        sportsMedals: 0
                    };
                }

                countryMedalsData[country].goldMedals += medals.goldMedals;
                countryMedalsData[country].silverMedals += medals.silverMedals;
                countryMedalsData[country].bronzeMedals += medals.bronzeMedals;
                countryMedalsData[country].sportsMedals += medals.sportsMedals;
            });

            return countryMedalsData;
        }

        function loadMedals(viewBy = 'members', showAll = false) {
            const memberList = document.getElementById('medal-list');
            memberList.innerHTML = '';

            let itemsToDisplay = [];

            if (viewBy === 'members') {
                itemsToDisplay = Object.keys(membersData).map(key => ({
                    ...membersData[key],
                    key
                }));

                if (!showAll) {
                    itemsToDisplay = itemsToDisplay.filter(member => {
                        return member.medals && (member.medals.goldMedals > 0 || member.medals.silverMedals > 0 || member.medals.bronzeMedals > 0 || member.medals.sportsMedals > 0);
                    });
                }

                // Sorting logic for members
                itemsToDisplay.sort((a, b) => {
                    const totalA = (a.medals?.goldMedals || 0) * 8 + (a.medals?.silverMedals || 0) * 4 + (a.medals?.bronzeMedals || 0) * 2 + (a.medals?.sportsMedals || 0);
                    const totalB = (b.medals?.goldMedals || 0) * 8 + (b.medals?.silverMedals || 0) * 4 + (b.medals?.bronzeMedals || 0) * 2 + (b.medals?.sportsMedals || 0);

                    if (totalB !== totalA) return totalB - totalA;

                    let aCount = (a.medals?.goldMedals || 0);
                    let bCount = (b.medals?.goldMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    aCount = (a.medals?.silverMedals || 0);
                    bCount = (b.medals?.silverMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    aCount = (a.medals?.bronzeMedals || 0);
                    bCount = (b.medals?.bronzeMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    aCount = (a.medals?.sportsMedals || 0);
                    bCount = (b.medals?.sportsMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    return a.key.localeCompare(b.key);
                });
            } else if (viewBy === 'countries') {
                const countryMedalsData = calculateCountryMedals();

                itemsToDisplay = Object.keys(countryMedalsData).map(key => ({
                    ...countryMedalsData[key],
                    key
                }));

                if (!showAll) {
                    itemsToDisplay = itemsToDisplay.filter(country => {
                        return country.goldMedals > 0 || country.silverMedals > 0 || country.bronzeMedals > 0 || country.sportsMedals > 0;
                    });
                }

                // Sorting logic for countries
                itemsToDisplay.sort((a, b) => {
                    const totalA = (a.goldMedals || 0) * 8 + (a.silverMedals || 0) * 4 + (a.bronzeMedals || 0) * 2 + (a.sportsMedals || 0);
                    const totalB = (b.goldMedals || 0) * 8 + (b.silverMedals || 0) * 4 + (b.bronzeMedals || 0) * 2 + (b.sportsMedals || 0);

                    if (totalB !== totalA) return totalB - totalA;

                    let aCount = (a.goldMedals || 0);
                    let bCount = (b.goldMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    aCount = (a.silverMedals || 0);
                    bCount = (b.silverMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    aCount = (a.bronzeMedals || 0);
                    bCount = (b.bronzeMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    aCount = (a.sportsMedals || 0);
                    bCount = (b.sportsMedals || 0);
                    if (aCount !== bCount) return bCount - aCount;

                    return a.countryNameShort.localeCompare(b.countryNameShort);
                });
            }


            itemsToDisplay.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'member-item medal-column';

                if (index === 0) {
                    listItem.classList.add('gold-border');
                } else if (index === 1) {
                    listItem.classList.add('silver-border');
                } else if (index === 2) {
                    listItem.classList.add('bronze-border');
                }

                const infoDiv = document.createElement('div');
                infoDiv.className = 'member-info';

                const nameSpan = document.createElement('span');
                nameSpan.className = 'username full-username';

                const nameLongSpan = document.createElement('span');
                nameLongSpan.className = 'username full-username';

                const nameShortSpan = document.createElement('span');
                nameShortSpan.className = 'username short-username';

                const idSpan = document.createElement('span');
                idSpan.className = 'user-id';

                if (viewBy === 'members') {
                    const members = Object.values(membersData);
                    const memberId = Object.keys(membersData).find(key => membersData[key].uid === item.uid);

                    if (memberId === 'IDK') return;

                    const imgContainer = createPfpContainer(item.pfp, memberId, item.country);

                    nameLongSpan.textContent = item.displayName;
                    nameShortSpan.textContent = memberId;
                    idSpan.textContent = `@${item.username}`;

                    listItem.appendChild(imgContainer);
                } else if (viewBy === 'countries') {
                    const img = document.createElement('img');
                    img.className = 'profile-img';
                    img.classList.add('no-cutout')
                    img.src = item.flagImage;
                    img.alt = item.countryNative;

                    nameLongSpan.textContent = item.countryName;
                    nameShortSpan.textContent = item.countryNameShort;
                    idSpan.textContent = `${item.countryNative}`;
                    idSpan.style.fontFamily = "";

                    listItem.appendChild(img);
                }

                infoDiv.appendChild(nameLongSpan);
                infoDiv.appendChild(nameShortSpan);
                infoDiv.appendChild(idSpan); 

                const goldMedalSpan = document.createElement('div');
                goldMedalSpan.className = 'medal';

                const silverMedalSpan = document.createElement('div');
                silverMedalSpan.className = 'medal';

                const bronzeMedalSpan = document.createElement('div');
                bronzeMedalSpan.className = 'medal';

                const sportsMedalsSpan = document.createElement('div');
                sportsMedalsSpan.className = 'medal';


                if (viewBy === 'members') {
                    const medals = item.medals || { goldMedals: 0, silverMedals: 0, bronzeMedals: 0, sportsMedals: 0 };
                    goldMedalSpan.textContent = medals.goldMedals;
                    silverMedalSpan.textContent = medals.silverMedals;
                    bronzeMedalSpan.textContent = medals.bronzeMedals;
                    sportsMedalsSpan.textContent = medals.sportsMedals;
                } else if (viewBy === 'countries') {
                    goldMedalSpan.textContent = item.goldMedals;
                    silverMedalSpan.textContent = item.silverMedals;
                    bronzeMedalSpan.textContent = item.bronzeMedals;
                    sportsMedalsSpan.textContent = item.sportsMedals;
                }

                if (goldMedalSpan.textContent === '0') goldMedalSpan.classList.add('zero');
                if (silverMedalSpan.textContent === '0') silverMedalSpan.classList.add('zero');
                if (bronzeMedalSpan.textContent === '0') bronzeMedalSpan.classList.add('zero');
                if (sportsMedalsSpan.textContent === '0') sportsMedalsSpan.classList.add('zero');

                listItem.appendChild(infoDiv);
                listItem.appendChild(goldMedalSpan);
                listItem.appendChild(silverMedalSpan);
                listItem.appendChild(bronzeMedalSpan);
                listItem.appendChild(sportsMedalsSpan);

                memberList.appendChild(listItem);
            });
        }

        let currentViewBy = 'members';
        let showAll = false;
        const switchButton = document.querySelector(`.tab-toggle`);
        const bigTitle = document.getElementById('pgm-title');
        const smallTitle = document.getElementById('pgs-title');

        function switchView(viewBy) {
            currentViewBy = viewBy;

            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));

            const activeButton = document.querySelector(`.tab-button[onclick="switchView('${viewBy}')"]`);
            activeButton.classList.add('active');

            loadMedals(viewBy, showAll);
        }

        function switchShowAll() {
            showAll = !showAll;
            loadMedals(currentViewBy, showAll);

            if (showAll)
                switchButton.classList.add('active');
            else
                switchButton.classList.remove('active');
        }

        function handleYearChange(event) {
            const selectedYear = event.target.value;
            loadPgmList(yearsData[selectedYear]);
            bigTitle.textContent = `PGM${selectedYear.slice(-2)}`;
            smallTitle.textContent = `PGS${selectedYear.slice(-2)}.5`;
        }

        function discordApiDoneLoading() {
            const selectedYear = document.getElementById('year-select').value;
            loadPgmList(yearsData[selectedYear]);
            loadWinners();
            loadMedals();
            showLangAttri();
            bigTitle.textContent = `PGM${selectedYear.slice(-2)}`;
            smallTitle.textContent = `PGS${selectedYear.slice(-2)}.5`;
        }

        var nowLang = 'en';
        var r = document.querySelector(':root');

        function showLangAttri() {
            r.style.setProperty('--lang-en', nowLang === 'en' ? 'block' : 'none');
            r.style.setProperty('--lang-zhTw', nowLang === 'zhTW' ? 'block' : 'none');
            r.style.setProperty('--lang-zhCn', nowLang === 'zhCN' ? 'block' : 'none');
            r.style.setProperty('--lang-vi', nowLang === 'vi' ? 'block' : 'none');
        }

        document.addEventListener('DOMContentLoaded', () => {
            nowLang = document.getElementById('language-select').value;
        });

        document.getElementById('language-select').addEventListener('change', function () {
            nowLang = this.value;
            showLangAttri();
        });

        generateMemberProfiles();
        document.getElementById('year-select').addEventListener('change', handleYearChange);</script>
</body>
</html>
