<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運dle — Zutek’s Secret Warehouse</title>
    <meta name="description" content="運ㄉㄡˇ，捷運版本的中文 wordle，題庫涵蓋臺北、新北、桃園、臺中、高雄捷運及高鐵、臺鐵、港鐵。">
    <meta property="og:image" content="https://zutek3134.taipei/images/yundleBanner.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://zutek3134.taipei/images/yundleBanner.png">

    <link rel="icon" type="image/x-icon" href="/images/zeeb.png">
    <link rel="alternate" hreflang="zh" href="https://zutek3134.taipei/zh-tw/lab/wordle/" />
    <link href='/stylesheets/style.css' rel='stylesheet'>
    <link href='/stylesheets/mandarinSupport.css' rel='stylesheet'>
    <link href='/js/details/stylesheet.css' rel='stylesheet'>
    <style>
        main {
            min-height: calc(100dvh - var(--nav-height));
        }

        #selectedLines details {
            padding: 0 var(--gap-half);
        }

        #selectedLines summary {
            font-size: 0.7em;
            margin: 0 calc(-1 * var(--gap-half));
        }

        #selectedLines .yundle-line-btns {
            margin: var(--gap-half) 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(8em, 1fr));
            gap: calc(var(--gap) * 0.3);
        }

        #selectedLines .yundle-line-btns .btn {
            white-space: nowrap;
            padding-left: 0;
            padding-right: 0;
        }

        .scrollRect {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: calc(-1 * var(--gap-half));
        }

        .guess {
            display: flex;
            flex-direction: row-reverse;
            width: 0;
            height: 0;
            max-width: 100%;
            overflow-x: auto;
            padding: var(--gap-half);
            --game-font-size: min(3rem, 10dvw);
            --gap: calc(var(--game-font-size) * 0.39);
            --gap-half: calc(var(--gap) * 0.5);
            --gap-quarter: calc(var(--gap-half) * 0.5);
            transition: width 0.5s ease-in-out, height 0.5s ease-in-out;
        }

        .guess .guess-row {
            margin: 0 var(--gap-quarter);
        }

        .guess-row {
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
        }

        .guess-row.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* .guess-row.visible.unfocus {
            opacity: 0.6;
        } */

        .guess-box {
            --state-colour: var(--border);
            min-width: calc(var(--game-font-size) + var(--gap));
            height: calc(var(--game-font-size) + var(--gap));
            margin: var(--gap-quarter);
            perspective: 1000px;
        }

        .guess-box.flip .guess-box-inner {
            transform: rotateY(180deg);
        }

        .guess-box-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .guess-row.rightLine .guess-box-back {
            --shadow-colour: var(--state-colour);
            background: var(--state-colour);
            color: var(--bg);
        }

        .guess-box.flip .guess-box-front {
            border-color: transparent;
        }

        .guess-box-back,
        .guess-box-front {
            background: transparent;
            border: calc(var(--game-font-size) * 0.04) solid var(--state-colour);
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        .guess-box-front {
            --state-colour: var(--border-half);
        }

        .guess-box-back {
            transform: rotateY(180deg);
            line-height: calc(var(--game-font-size) + var(--gap) * 0.75);
            font-size: var(--game-font-size);
            font-weight: 700;
            color: var(--state-colour);
            box-shadow: 0 0 10px var(--shadow-colour);
        }

        .guess-box.success {
            --state-colour: var(--success);
        }

        .guess-box.danger {
            --state-colour: var(--danger);
        }

        .typeArea {
            position: relative;
            display: flex;
            justify-content: center;
        }

        .typeArea input {
            width: 100%;
            padding: var(--gap-half);
            background: var(--card-bg);
            font-size: 1.25rem;
        }

        #settings input {
            font-family: var(--mono-font);
        }

        .typeArea .submitBtn {
            --btn-theme: var(--card-bg);
            color: var(--color);
            border-width: 1px;
        }

        .typeArea .submitBtn:not([disabled]):hover {
            color: var(--bg);
        }

        .typeArea .submitBtn:focus {
            border-color: var(--border);
        }

        .typeArea input:disabled {
            background: var(--bg);
            border-color: var(--card-bg);
        }

        #settings>.item {
            display: flex;
        }

        #settings h3 {
            margin: var(--gap-half);
        }

        #settings input {
            margin: auto;
            min-width: 3em;
        }

        #settings .btn:not(.btn-fill):not(.disabled):not([disabled]):hover {
            --btn-bg: var(--danger);
        }

        #tut {
            flex-direction: row;
            display: flex;
            overflow-x: auto;
            padding: var(--gap-half);
            --game-font-size: min(6dvw, 3rem);
        }

        hr {
            margin-bottom: 1em;
        }

        .vr {
            border-left: 1px dashed var(--border);
            height: 2em;
        }

        .game-nav {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            padding: var(--gap-half);
            justify-content: center;
            align-items: center;
            gap: var(--gap-half);
        }

        .game-nav h1 {
            margin: 0;
        }

        .game-nav-actions {
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
        }

        .game-nav-actions>a {
            padding: 0.5em 1em;
        }

        .game-nav-actions>a:hover {
            background-color: var(--card-bg);
        }

        .game-nav-actions #question {
            font-weight: 700;
        }

        .game-nav #led {
            width: 100%;
            height: 100%;
            background-color: var(--bg-dark);
            border-radius: var(--gap-half);
            position: relative;
            overflow: hidden;
        }

        .game-nav #led p {
            position: absolute;
            left: 100%;
            top: 25%;
            margin: 0;
            text-wrap: nowrap;
            transition: left 6s linear;
        }

        .game-nav #led p.enter {
            left: -100%;
        }

        #chances-label #alt {
            display: none;
        }

        #chances-label[data-mode="alt"] #normal {
            display: none;
        }

        #chances-label[data-mode="alt"] #alt {
            display: inline;
        }

        #score-skill::before {
            content: '安全係數';
        }

        #score-luck::before {
            content: '幸運指數';
        }

        .scoreArea::before {
            display: block;
            color: var(--primary);
            font-size: 0.7em;
            opacity: 0.7;
        }

        .scoreArea::after {
            content: '%';
            margin-left: 0.2em;
            font-size: 0.6em;
        }

        #wordleBotOutput sub {
            vertical-align: baseline;
            font-size: 0.7em;
            margin-left: 0.4em;
        }

        .wordleBotDetailsIcon {
            --alert-icon: url('data: image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5"></path></svg>');
        }

        @media only screen and (max-width: 600px) {
            .game-nav {
                grid-template-columns: 1fr;
            }

            .game-nav h1 {
                text-align: center;
            }

            .game-nav-actions {
                justify-content: center;
            }

            .game-nav #led {
                height: 2.5rem;
            }

            .game-nav #led p {
                top: 0.625rem;
            }
        }
    </style>
    <script src="/js/modal/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
</head>

<body>
    <nav id="nav-placeholder" data-qr="true"></nav>
    <div id="modal-gameSettings" class="modal" data-onclose="loadGame">
        <div class="content show">
            <div class="header">
                <span class="close" onclick="closeModal()"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12 6.47 2 12 2m3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"></path>
                        </svg></span></span>
                <h2>運<span class="hanLat hl-l">dle</span></h2>
            </div>
            <div class="body">
                <h2>壹、設定</h2>
                <div class="row mar-b-2" id="settings">
                    <div class="item">
                        <h3 class="text-nowrap">最少</h3>
                        <input type="number" id="minWords" class="width-full" placeholder="預設：2" min="2" max="6" value="2">
                        <h3 class="text-nowrap">字，最多</h3>
                        <input type="number" id="maxWords" class="width-full" placeholder="預設：6" min="2" max="6" value="6">
                        <h3 class="text-nowrap">字</h3>
                    </div>
                    <div class="item">
                        <h3 class="text-nowrap">遊戲機會</h3>
                        <input type="number" id="maxAttempts" class="width-full" placeholder="預設：6" min="1" max="12" value="6">
                        <h3 class="text-nowrap">次</h3>
                    </div>
                    <label class="item-width">
                        <label class="switch-holder mar-l-05"><label class="switch">
                                <input type="checkbox" id="inputHint">
                                <span class="slider"></span>
                            </label>
                            <h3 class="switch-name">輸入建議</h3>
                        </label>
                    </label>
                    <div class="item-full">
                        <h3>路線範圍（<span id="chosenCount" class="hanLat hl-r">8</span>條）</h3>
                        <div id="selectedLines" class="pad-rl-05">
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji" src="logo/tpe.svg" draggable="false"><img class="twemoji mar-0" src="logo/ntpe.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn btn-fill" data-name="tpe-br">文湖線</button>
                                    <button class="btn btn-fill" data-name="tpe-r">淡水信義線</button>
                                    <button class="btn btn-fill" data-name="tpe-g">松山新店線</button>
                                    <button class="btn btn-fill" data-name="tpe-o">中和新蘆線</button>
                                    <button class="btn btn-fill" data-name="tpe-bl">板南線</button>
                                    <button class="btn btn-fill" data-name="ntpe-y">新北環狀線</button>
                                    <button class="btn btn-fill" data-name="ntpe-v">淡海輕軌</button>
                                    <button class="btn btn-fill" data-name="ntpe-k">安坑輕軌</button>
                                    <button class="btn" data-name="ntpe-lb">三鶯線</button>
                                    <button class="btn" data-name="tpe-lg">萬大中和線</button>
                                    <button class="btn" data-name="tpe-mk">貓空纜車</button>
                                </div>
                            </details>
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji" src="logo/tyn.svg" draggable="false"><img class="twemoji" src="logo/tch.svg" draggable="false"><img class="twemoji mar-0" src="logo/khs.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn" data-name="tyn-a">桃園機場線</button>
                                    <button class="btn" data-name="tyn-g">桃園綠線</button>
                                    <button class="btn" data-name="tch-1">烏日文心北屯線</button>
                                    <button class="btn" data-name="khs-r">高雄紅線</button>
                                    <button class="btn" data-name="khs-o">高雄橘線</button>
                                    <button class="btn" data-name="khs-c">高雄環狀輕軌</button>
                                </div>
                            </details>
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji" src="logo/thsr.svg" draggable="false"><img class="twemoji invert-in-night" src="logo/tr.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn" data-name="tw-hsr">臺灣高速鐵路</button>
                                    <button class="btn" data-name="tw-r-northern">西部幹線北段</button>
                                    <button class="btn" data-name="tw-r-mountain">西部幹線山線</button>
                                    <button class="btn" data-name="tw-r-coast">西部幹線海線</button>
                                    <button class="btn" data-name="tw-r-southern">西部幹線南段</button>
                                    <button class="btn" data-name="tw-r-pingtung">西部幹線屏東線</button>
                                    <button class="btn" data-name="tw-r-yilan">東部幹線宜蘭線</button>
                                    <button class="btn" data-name="tw-r-bayhuay">東部幹線北迴線</button>
                                    <button class="btn" data-name="tw-r-taitung">東部幹線臺東線</button>
                                    <button class="btn" data-name="tw-r-nanhuay">南迴線</button>
                                    <button class="btn" data-name="tw-r-shunau">深澳支線</button>
                                    <button class="btn" data-name="tw-r-pinghsi">平溪支線</button>
                                    <button class="btn" data-name="tw-r-nanwan">內灣／六家支線</button>
                                    <button class="btn" data-name="tw-r-jiji">集集支線</button>
                                    <button class="btn" data-name="tw-r-shalwun">沙崙支線</button>
                                </div>
                            </details>
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji mar-0" src="logo/hkmtr.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn" data-name="hk-eal">東鐵綫</button>
                                    <button class="btn" data-name="hk-ktl">觀塘綫</button>
                                    <button class="btn" data-name="hk-twl">荃灣綫</button>
                                    <button class="btn" data-name="hk-isl">港島綫</button>
                                    <button class="btn" data-name="hk-tcl">東涌綫</button>
                                    <button class="btn" data-name="hk-tkl">將軍澳綫</button>
                                    <button class="btn" data-name="hk-drl">迪士尼綫</button>
                                    <button class="btn" data-name="hk-sil">南港島綫</button>
                                    <button class="btn" data-name="hk-tml">屯馬綫</button>
                                    <button class="btn" data-name="hk-ael">機場快綫</button>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
                <h2>貳、玩法</h2>
                <div class="mar-b-3">
                    <p>每次答題時，框框及底色會標示其及目標車站之差異。字數、機會、範圍等均可自上方設定中自行調整。</p>
                    <hr />
                    <div class="guess-row visible" id="tut">
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    東
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    門
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，可由「<span class="hanLat hl-r">1</span>灰框」及「<span class="hanLat hl-r">5</span>綠框」推得以下線索：</p>
                    <ol class="informal">
                        <li>目標車站僅有<span class="hanLat">2</span>字，因有<span class="hanLat">4</span>空格為綠框；</li>
                        <li>目標車站之第二字為「門」，因「門」字為綠框；</li>
                        <li>目標車站並非位於「淡水信義線」或「中和新蘆線」，因底色非塗滿。</li>
                    </ol>
                    <p>綜上，目標車站可能為「北門」或「西門」，非「小南門」。</p>
                    <hr />
                    <div class="guess-row visible" id="tut">
                        <div class="guess-box flip danger">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    海
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip danger">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    山
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，可獲得以下資訊：</p>
                    <ol class="informal">
                        <li>目標車站僅有<span class="hanLat">4</span>字；</li>
                        <li>目標車站包含「海」、「山」二字，但目前位置錯誤；</li>
                        <li>目標車站並非位於「板南線」。</li>
                    </ol>
                    <p>綜上，目標車站可能為「濱海義山」。</p>
                    <hr />
                    <div class="guess-row visible rightLine" id="tut">
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    南
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    港
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    展
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    覽
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    館
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，可獲得以下資訊：</p>
                    <ol class="informal">
                        <li>目標車站不超過<span class="hanLat">5</span>字；</li>
                        <li>目標車站首二字為「南港」；</li>
                        <li>目標車站位於「板南線」或「文湖線」。</li>
                    </ol>
                    <p>綜上，目標車站可能為「南港」，非「南港軟體園區」。</p>
                    <hr />
                    <div class="guess-row visible rightLine" id="tut">
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    劍
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    潭
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，所有格子皆為綠底，表示已猜出目標車站，恭喜過關。</p>
                </div>
                <h2>參、聲明</h2>
                <p class="indent">本遊戲<q class="books">運<span class="hanLat hl-l">dle</span></q>的製作，蓋受到知名網路工程師<u>喬許・華德爾</u>之<q class="books"><a class="inlineLink" href="https://www.nytimes.com/games/wordle/index.html" target="_blank">Wordle</a></q>影響及啟發。本遊戲目的為提供在地化及新奇的遊戲體驗，無侵權、營利之意圖。本遊戲題庫為開發者自行至官方或第三公共資源手動擷取之，不存在大量濫用或占用資源行為。本遊戲僅於瀏覽紀錄中儲存設定選項，不收集使用者資料。本遊戲由<span class="hanLat">Zutek 3134</span>獨立開發而成，且不熟悉之題庫內容亦已交由同好覆覈。</p>
                <p class="indent">本遊戲也特地開發<q>運斗ㄟㄞ</q>，同為<span class="hanLat">Zutek 3134</span>所獨立製作。原用於學習、推理、篩選最佳解答以快速縮小潛在答案範圍，進而有效地破關；後另兼分析使用者答案之功能，判斷其中之策略謀劃及運氣成分。如欲體驗，請將下方選項開啟，運斗ㄟㄞ將於遊戲結束時產出一份報告。</p>
                <div class="row">
                    <div id="wordleBotButton" class="item btn btn-secondary"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5" />
                            </svg></span>啟用<q>運斗ㄟㄞ</q>智慧分析</div>
                </div>
                <p class="indent">為避免遊戲從推理變質為套公式，強烈建議使用者於開啟上方選項前自行摸索遊戲，找出自己破關的規律，並享受過程，而非一昧帶入、背誦答案。開發者認為，這是機器人才該做的事情，故先行上刀山下火海地訓練出<q>運斗ㄟㄞ</q>。當使用者已準備好挑戰ㄟㄞ，便可開啟選項，與之一較高下。</p>
                <p class="indent">敬祝　遊戲愉快</p>
            </div>
            <div class="footer">
                <p class="text-centre">關閉此頁面後，直至下次遊戲前，皆不得再編輯。</p>
            </div>
        </div>
    </div>
    <div id="modal-qrcode" class="modal">
        <div class="content show">
            <div class="header">
                <span class="close" onclick="closeModal()"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12 6.47 2 12 2m3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"></path>
                        </svg></span></span>
                <h2><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M4 4h6v6H4zm16 0v6h-6V4zm-6 11h2v-2h-2v-2h2v2h2v-2h2v2h-2v2h2v3h-2v2h-2v-2h-3v2h-2v-4h3zm2 0v3h2v-3zM4 20v-6h6v6zM6 6v2h2V6zm10 0v2h2V6zM6 16v2h2v-2zm-2-5h2v2H4zm5 0h4v4h-2v-2H9zm2-5h2v4h-2zM2 2v4H0V2a2 2 0 0 1 2-2h4v2zm20-2a2 2 0 0 1 2 2v4h-2V2h-4V0zM2 18v4h4v2H2a2 2 0 0 1-2-2v-4zm20 4v-4h2v4a2 2 0 0 1-2 2h-4v-2z" />
                        </svg></span>分享此遊戲</h2>
            </div>
            <div class="body">
                <div style="display: flex; flex-direction: column;">
                    <img src="share_nightTheme.svg" class="hide-in-light" draggable="false" loading="lazy" style="margin: auto;max-width: 60dvw;max-height: 60dvh;">
                    <img src="share_lightTheme.svg" class="hide-in-night" draggable="false" loading="lazy" style="margin: auto;max-width: 60dvw;max-height: 60dvh;">
                    <p class="text-centre"><a class="inlineLink" href="https://zutek3134.taipei/zh-tw/lab/yundle/"><code>https://zutek3134.taipei/zh-tw/lab/yundle/</code></a></p>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-gameOverShare" class="modal">
        <div class="content show">
            <div class="header">
                <span class="close" onclick="closeModal()"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12 6.47 2 12 2m3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"></path>
                        </svg></span></span>
                <h2>分享結果<span class="text-small">（點擊圖片即可放大）</span></h2>
            </div>
            <div class="body">
                <div class="text-centre">
                    <a draggable="false"><img id="shareImg" src="" class="bordered rounded attachment" draggable="false"></a>
                </div>
            </div>
        </div>
    </div>
    <main>
        <div class="container">
            <div class="game-nav">
                <h1>運<span class="hanLat hl-l">dle</span></h1>
                <div class="game-nav-actions">
                    <a href="/metro/" target="_blank">捷運小工具<span class="twemoji" style="font-size: 0.7em; margin: 0 0 0 0.3em; vertical-align: middle;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                <path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2m6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.75.75 0 0 1-1.042-.018.75.75 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1" />
                            </svg></span></a>
                    <div class="vr"></div>
                    <a id="chances-label" data-mode="normal" onclick="this.dataset.mode = this.dataset.mode === 'normal' ? 'alt' : 'normal'"><span id="normal">第 1 之 6 次</span><span id="alt">餘 5 次</span></a>
                    <div class="vr"></div>
                    <a id="question" onclick="openModal('gameSettings')">？</a>
                </div>
                <div id="led"></div>
                <div class="typeArea">
                    <input list="guessesList" type="text" id="inputField" placeholder="輸入車站名稱" style="border-radius: var(--gap-half) 0 0 var(--gap-half);">
                    <button class="btn btn-fill submitBtn" onclick="handleEnterButton()" style="border-radius: 0 var(--gap-half) var(--gap-half) 0;"><span class="twemoji" style="margin-right: 0.1em;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4" />
                            </svg></span></button>
                </div>
            </div>
            <hr>
            <p class="text-centre display-none" style="opacity: 0.7"><span id="game-curRow" class="hanLat hl-r">1</span>之<span id="game-totalChances" class="hanLat hl-l">6</span></p>
            <div class="scrollRect">
                <div class="guess" id="genField">
                </div>
            </div>
            <div id="gameOverTab" class="text-centre width-full mar-t-1 display-none">
                <div>
                    <button id="shareBtn" class="btn btn-fill" style="margin-right: var(--gap)" onclick="openModal('gameOverShare');"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="m21 12-7-7v4C7 10 4 15 3 20c2.5-3.5 6-5.1 11-5.1V19z" />
                            </svg></span>分享結果</button>
                    <button id="replayBtn" class="btn" onclick="location.reload();"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 4c2.1 0 4.1.8 5.6 2.3 3.1 3.1 3.1 8.2 0 11.3-1.8 1.9-4.3 2.6-6.7 2.3l.5-2c1.7.2 3.5-.4 4.8-1.7 2.3-2.3 2.3-6.1 0-8.5C15.1 6.6 13.5 6 12 6v4.6l-5-5 5-5zM6.3 17.6C3.7 15 3.3 11 5.1 7.9l1.5 1.5c-1.1 2.2-.7 5 1.2 6.8q.75.75 1.8 1.2l-.6 2q-1.5-.6-2.7-1.8" />
                            </svg></span>再玩一次</button>
                </div>
                <div class="table-container mar-t-1">
                    <table>
                        <tr>
                            <th style="width: 33%;">字數</th>
                            <th style="width: 33%;">機會</th>
                            <th style="width: 33%;">路線</th>
                        </tr>
                    </table>
                </div>
            </div>

            <canvas id="gameCanvas" style="display: none;"></canvas>
        </div>
        <div class="container display-none" id="wordleBotOutputContainer">
            <details class="wordleBotDetailsIcon">
                <summary>運斗ㄟㄞ研究室</summary>
                <div>
                    <div class="row">
                        <div class="item">
                            <p class="mar-0 display text-centre"><span class="scoreArea" id="score-skill">0</span></p>
                        </div>
                        <div class="item">
                            <p class="mar-0 display text-centre"><span class="scoreArea" id="score-luck">0</span></p>
                        </div>
                    </div>
                    <div class="table-container mar-t-1">
                        <table id="wordleBotOutput" class="text-centre">
                            <tr>
                                <th style="width: 6em;">所猜站名</th>
                                <th style="width: 4em;">安全係數</th>
                                <th style="width: 4em;">幸運指數</th>
                                <th style="width: 4em;">潛在答案數量</th>
                                <th style="width: 10em;">ㄟㄞ首選</th>
                                <th style="width: 10em;">ㄟㄞ次選</th>
                            </tr>
                        </table>
                    </div>
                </div>
            </details>
        </div>
        <div class="container display-none">
            <div class="card">
                <div class="title">
                    <h3 class="mar-0 text-centre">作弊不可取</h3>
                </div>
                <div class=" body">
                    <!-- 請勿作弊，作弊可恥 -->
                    <p id="possibleSolutions" class="mar-0"></p>
                </div>
            </div>
        </div>
    </main>
    <footer id="footer-placeholder">
        <div class="container">
            <h2>相關遊戲</h2>
            <div class="box rounded bordered">
                <a href="/zh-tw/lab/mrtPro/" draggable="false">
                    <div class="lazy-image-container">
                        <img src="https://dummyimage.com/960x540" data-src="/images/mrtProBanner.png" alt="通勤到哪裡" class="rounded" style="width: 100%;" draggable="false" />
                    </div>
                </a>
            </div>
        </div>
    </footer>
    <script src="/includes/includes.js" data-comments></script>
    <script src="/js/tabs/script.js"></script>
    <script src="/js/details/script.js"></script>
    <script src="/js/autocomplete/script.js"></script>
    <script>
        const YundleGame = (() => {
            const dom = {
                led: document.getElementById('led'),
                genField: document.getElementById('genField'),
                inputField: document.getElementById('inputField'),
                submitBtn: document.querySelector('button.submitBtn'),
                gameCanvas: document.getElementById('gameCanvas'),
                shareImg: document.getElementById('shareImg'),
                selectedLines: document.getElementById('selectedLines'),
                chosenCount: document.getElementById('chosenCount'),
                gameOverTab: document.querySelector('#gameOverTab'),
                wordleBotOutputContainer: document.getElementById('wordleBotOutputContainer'),
                wordleBotOutput: document.getElementById('wordleBotOutput'),
                possibleSolutions: document.getElementById('possibleSolutions'),

                modalGameSettings: document.getElementById('modal-gameSettings'),
                minWords: document.querySelector('#minWords'),
                maxWords: document.querySelector('#maxWords'),
                maxAttempts: document.querySelector('#maxAttempts'),
                inputHint: document.querySelector('#inputHint'),
                wordleBotButton: document.querySelector('#wordleBotButton'),

                chancesLabelNormal: document.querySelector('#chances-label #normal'),
                chancesLabelAlt: document.querySelector('#chances-label #alt'),
                scoreSkill: document.getElementById('score-skill'),
                scoreLuck: document.getElementById('score-luck'),
                gameCurRow: document.getElementById('game-curRow'),
                gameTotalChances: document.getElementById('game-totalChances')
            };

            const state = {
                settings: {
                    maxLength: 6,
                    minLength: 2,
                    maxAttempts: 6,
                    selectedLines: [],
                    enableHint: false,
                    enableBot: false
                },

                currentRow: 0,
                fullData: [],
                wordList: [],
                targetWord: "",
                paddedTarget: "",
                targetLine: [],
                isGameOver: false,
                isUselessGuess: false,
                userData: { skill: [], luck: [], guess: [], botGuess: [] },

                wordleBotList: [],
                wordleBotLines: [],
                wordleBotAnalysis: [],
                wordleBotListDifferences: 0,
                wordleBotTotalPossibleCount: 0,
                wordleBotTargetLength: 0,

                replaceRules: {},
                ledTimers: [],
                ledMsg: null,
                verticalList: ["（", "）"]
            };

            const utils = {
                calculateMedian(arr) {
                    const sorted = [...arr].sort((a, b) => a - b);
                    const mid = Math.floor(sorted.length / 2);
                    return sorted.length % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];
                },
                sideScroll(element, direction, speed, distance, step) {
                    let scrollAmount = 0;
                    const slideTimer = setInterval(() => {
                        element.scrollLeft = direction === 'left'
                            ? element.scrollLeft - step
                            : element.scrollLeft + step;
                        scrollAmount += step;
                        if (scrollAmount >= distance) clearInterval(slideTimer);
                    }, speed);
                }
            };

            function buttonToggle(element) {
                if (element.classList.contains('disabled')) return;
                element.classList.toggle('btn-fill');
                dom.chosenCount.textContent = dom.selectedLines.querySelectorAll('.btn-fill').length;
            }

            function showMessage(msg) {
                if (state.ledMsg) {
                    state.ledTimers.forEach(timer => clearTimeout(timer));
                    state.ledMsg.remove();
                    state.ledMsg = null;
                }

                const newLedMsg = document.createElement('p');
                newLedMsg.innerHTML = msg;
                dom.led.appendChild(newLedMsg);
                state.ledMsg = newLedMsg;

                state.ledTimers[0] = setTimeout(() => {
                    newLedMsg.classList.add('enter');
                    state.ledTimers[1] = setTimeout(() => {
                        newLedMsg.remove();
                        state.ledMsg = null;
                    }, 6500);
                }, 100);
            }

            const game = {
                loadGame() {
                    dom.modalGameSettings.removeAttribute('data-onclose');
                    const formElements = dom.modalGameSettings.querySelectorAll('input, .btn');
                    formElements.forEach(element => {
                        element.disabled = true;
                        element.classList.add('disabled');
                    });

                    const settings = {
                        minLength: Math.max(Number(dom.minWords.value), 2),
                        maxLength: Math.min(Number(dom.maxWords.value), 6),
                        maxAttempts: Math.min(Math.max(Number(dom.maxAttempts.value), 1), 12),
                        selectedLines: Array.from(dom.selectedLines.querySelectorAll('.btn-fill'))
                            .map(el => el.getAttribute('data-name')),
                        enableHint: dom.inputHint.checked,
                        enableBot: dom.wordleBotButton.classList.contains('btn-fill')
                    };
                    state.settings = settings;
                    localStorage.setItem('wordleSettings', JSON.stringify(settings));

                    if (!settings.enableBot) {
                        dom.wordleBotOutputContainer.style.display = "none";
                    }

                    game.updateChances(1);
                    dom.gameTotalChances.textContent = settings.maxAttempts;

                    game.loadDictionary().catch(err => {
                        console.error("Load dictionary error:", err);
                    });

                    game.createGridNew();
                    dom.genField.style.height = dom.genField.scrollHeight + 10 + 'px';
                },

                async loadDictionary() {
                    try {
                        const response = await fetch("data.json");
                        state.fullData = await response.json();
                        state.wordList = Object.keys(state.fullData).filter(word =>
                            word.length >= state.settings.minLength &&
                            word.length <= state.settings.maxLength &&
                            state.fullData[word].some(line => state.settings.selectedLines.includes(line))
                        );
                        await game.loadReplaceList();
                    } catch (err) {
                        throw err;
                    }
                },

                async loadReplaceList() {
                    try {
                        const response = await fetch("/metro/data/name_replace_rules.json");
                        state.replaceRules = await response.json();
                        game.selectRandomWord();
                    } catch (err) {
                        console.error("Load replace list error:", err);
                    }
                },

                selectRandomWord() {
                    if (state.wordList.length <= 0) {
                        showMessage("設定有誤");
                        game.controlInputs();
                        return;
                    }

                    const randomIndex = Math.floor(
                        Math.random() * state.wordList.length + Date.now() % state.wordList.length
                    ) % state.wordList.length;
                    state.targetWord = state.wordList[randomIndex];
                    state.paddedTarget = state.targetWord.padEnd(state.settings.maxLength, ' ');
                    state.targetLine = game.getLinesForStation(state.targetWord);

                    if (state.settings.enableHint) {
                        const sortWordList = [...state.wordList].sort((a, b) => {
                            if (a.length !== b.length) return a.length - b.length;
                            return a.localeCompare(b, 'zh-Hant');
                        });
                        setupAutocomplete(dom.inputField, sortWordList, state.replaceRules);
                    }

                    state.wordleBotList = state.wordList.map(word =>
                        word.padEnd(state.settings.maxLength, ' ')
                    );
                    state.wordleBotLines = [...state.settings.selectedLines];
                    state.wordleBotTotalPossibleCount = state.wordleBotList.length;
                    game.runAlgo();
                },

                getLinesForStation(name) {
                    return (state.fullData[name.trim()] || []).filter(line =>
                        state.settings.selectedLines.includes(line)
                    );
                },

                shareLine(station, line = state.targetLine) {
                    const guessline = game.getLinesForStation(station.trim());
                    return line.some(l => guessline.includes(l));
                },

                runAlgo() {
                    const isItLuckTime = state.wordleBotAnalysis.length > 0 &&
                        state.wordleBotAnalysis[0].score === state.wordleBotAnalysis[state.wordleBotAnalysis.length - 1].score;

                    if (state.userData.guess.length > 0) {
                        let curScore;
                        if ((state.wordleBotListDifferences === 0 && !state.isGameOver) || state.isUselessGuess) {
                            curScore = 0;
                        } else if (isItLuckTime) {
                            curScore = -1;
                        } else {
                            const guess = state.userData.guess[state.currentRow].trim();
                            for (const obj of state.wordleBotAnalysis) {
                                if (obj.word.trim() === guess) {
                                    curScore = Math.round(99 * obj.score / state.wordleBotAnalysis[0].score * 10) / 10;
                                    break;
                                }
                            }
                        }
                        state.userData.skill.push(curScore);

                        let fullScore = 0;
                        let skillNull = 0;
                        state.userData.skill.forEach(s => {
                            if (s >= 0) fullScore += s;
                            else skillNull++;
                        });
                        dom.scoreSkill.textContent = skillNull === state.userData.skill.length
                            ? '--'
                            : Math.round(fullScore / (state.userData.skill.length - skillNull) * 10) / 10;
                    }

                    state.wordleBotAnalysis = new Array(state.wordleBotList.length);
                    const letterFrequency = {};
                    const lineFrequency = {};
                    let transferStationCount = 0;

                    state.wordleBotList.forEach(word => {
                        for (const letter of word) {
                            letterFrequency[letter] = (letterFrequency[letter] || 0) +
                                (letter === " " ? (state.wordleBotTargetLength === 0 ? 1 : 0) : 1);
                        }

                        const lines = game.getLinesForStation(word);
                        for (const line of lines) {
                            lineFrequency[line] = (lineFrequency[line] || 0) + 1;
                        }

                        if (lines.length > 1) transferStationCount++;
                    });

                    const lineFreqArr = Object.entries(lineFrequency).sort((a, b) => b[1] - a[1]);
                    const lineWithMostSta = lineFreqArr[0] || [null, 0];
                    const remainingLines = state.wordleBotLines.length;
                    const lineMedianSta = utils.calculateMedian(Object.values(lineFrequency));
                    const threshold = lineWithMostSta[1] > 1;
                    const letterWeight = (threshold && transferStationCount > 0) ? 0.7 : 1;
                    const lineWeight = ((remainingLines > 2 || transferStationCount === 0) && (lineWithMostSta[1] > 1))
                        ? (threshold ? 1 : 0.5)
                        : 0;

                    state.wordleBotList.forEach((word, index) => {
                        let score = 0;
                        for (const letter of word) {
                            score += (letterFrequency[letter] || 0) * letterWeight;
                        }
                        const lines = game.getLinesForStation(word);
                        lines.forEach(line => {
                            if (lines.length < 2 && !threshold) return;
                            const mostStaLine = (line === lineWithMostSta[0] && threshold) ? 2 : 1;
                            score += (lineFrequency[line] || 0) * lineWeight * mostStaLine;
                        });
                        state.wordleBotAnalysis[index] = { word, score: Math.round(score) };
                    });

                    state.wordleBotAnalysis.sort((a, b) => b.score - a.score);

                    if (state.userData.guess.length > 0 && state.wordleBotTotalPossibleCount > 1) {
                        let curLuck = -1;
                        if (state.wordleBotListDifferences === 0) {
                            curLuck = 0;
                        } else if (isItLuckTime && !state.isUselessGuess) {
                            curLuck = state.isGameOver ? 100 : 0;
                        } else {
                            curLuck = Math.round(
                                (1 - ((state.wordleBotList.length - 1) / state.wordleBotTotalPossibleCount)) * 100 * 10
                            ) / 10;
                        }
                        state.userData.luck.push(curLuck);

                        let fullLuck = 0;
                        let luckNull = 0;
                        state.userData.luck.forEach(s => {
                            if (s >= 0) fullLuck += s;
                            else luckNull++;
                        });
                        dom.scoreLuck.textContent = luckNull === state.userData.luck.length
                            ? '--'
                            : Math.round(fullLuck / (state.userData.luck.length - luckNull) * 10) / 10;
                    }

                    state.wordleBotTotalPossibleCount = state.wordleBotList.length;

                    if (state.userData.guess.length > 0) {
                        const skillString = state.userData.skill[state.currentRow] >= 0
                            ? ` scoreArea">${state.userData.skill[state.currentRow]}`
                            : '">--';
                        const luckString = state.userData.luck[state.currentRow] >= 0
                            ? ` scoreArea">${state.userData.luck[state.currentRow]}`
                            : '">--';
                        const potentialString = !state.isGameOver
                            ? `${state.wordleBotTotalPossibleCount} <sub>-${state.wordleBotListDifferences}</sub>`
                            : '--';
                        const botGuess = state.userData.botGuess[state.currentRow];
                        const wordleBotGuessRow = botGuess[1] !== ""
                            ? `<td>${botGuess[0]}</td><td>${botGuess[1]}</td>`
                            : `<td colspan="2">${botGuess[0]}`;

                        dom.wordleBotOutput.innerHTML += `
                    <tr>
                        <td class="text-nowrap">${state.userData.guess[state.currentRow]}</td>
                        <td class="text-nowrap${skillString}</td>
                        <td class="text-nowrap${luckString}</td>
                        <td>${potentialString}</td>
                        ${wordleBotGuessRow}
                    </tr>
                `;
                    }

                    const bestOptions = [];
                    let optionIndex = 0;
                    let optionScore = 0;
                    while (optionIndex < state.wordleBotAnalysis.length) {
                        if (state.wordleBotAnalysis[optionIndex].score < optionScore) break;
                        bestOptions.push(`<span class="text-nowrap">${state.wordleBotAnalysis[optionIndex].word.trim()}</span>`);
                        optionScore = state.wordleBotAnalysis[optionIndex].score;
                        optionIndex++;
                    }

                    const runnerUpOptions = [];
                    while (optionIndex < Math.min(4, state.wordleBotAnalysis.length)) {
                        runnerUpOptions.push(`<span class="text-nowrap">${state.wordleBotAnalysis[optionIndex].word.trim()}</span>`);
                        optionIndex++;
                    }

                    state.userData.botGuess.push([bestOptions.join('、'), runnerUpOptions.join('、')]);
                },

                createGridNew() {
                    const row = document.createElement('div');
                    row.classList.add('guess-row');
                    row.id = `r${state.currentRow}`;

                    const fragment = document.createDocumentFragment();
                    for (let j = 0; j < state.settings.maxLength; j++) {
                        const tile = document.createElement('div');
                        tile.classList.add('guess-box');
                        tile.setAttribute('data-row', state.currentRow);
                        tile.setAttribute('data-col', j);

                        const tileInner = document.createElement('div');
                        tileInner.classList.add('guess-box-inner');

                        const tileFront = document.createElement('div');
                        tileFront.classList.add('guess-box-front');

                        const tileBack = document.createElement('div');
                        tileBack.classList.add('guess-box-back');

                        tileInner.append(tileBack, tileFront);
                        tile.appendChild(tileInner);
                        fragment.appendChild(tile);
                    }
                    row.appendChild(fragment);
                    dom.genField.appendChild(row);

                    void row.offsetWidth;
                    row.classList.add('visible');

                    dom.genField.style.width = `${dom.genField.scrollWidth}px`;
                    if (dom.genField.scrollWidth > dom.genField.parentElement.clientWidth) {
                        utils.sideScroll(dom.genField, "left", 25, 100, 5);
                    }

                    dom.gameCurRow.textContent = state.currentRow + 1;
                },

                handleEnter() {
                    let rawGuess = dom.inputField.value.trim();
                    state.replaceRules.stringReplace?.forEach(rule => {
                        rawGuess = rawGuess.replaceAll(rule.from, rule.to);
                    });
                    rawGuess = state.replaceRules.exactReplace?.[rawGuess] || rawGuess;

                    if (!rawGuess) return;

                    dom.inputField.value = "";
                    dom.inputField.dispatchEvent(new Event("input"));

                    if (['放棄', '投降', '答案', '不知道', '不曉得'].includes(rawGuess)) {
                        showMessage(state.targetWord);
                        game.controlInputs(state.targetWord);
                        dom.wordleBotOutputContainer.classList.remove('display-none');
                        return;
                    } else if (state.userData.guess[state.currentRow - 1] === "龍山寺" && rawGuess === "天后宮") {
                        showMessage("雕刻精美唐山公");
                        return;
                    }

                    const guess = rawGuess;
                    const paddedGuess = guess.padEnd(state.settings.maxLength, ' ');

                    if (!state.wordList.includes(guess)) {
                        showMessage(state.fullData[guess] ? "不在所選範圍內" : "查無此站");
                        return;
                    }

                    game.checkGuess(paddedGuess);
                },

                checkGuess(guess) {
                    dom.inputField.focus();

                    state.userData.guess.push(guess.trim());
                    state.isGameOver = guess.trim() === state.targetWord;
                    state.isUselessGuess = !state.wordleBotList.includes(guess);

                    const rowTiles = Array.from(dom.genField.querySelectorAll(`.guess-box[data-row="${state.currentRow}"]`));
                    const targetLetters = state.paddedTarget.split('');
                    const guessLetters = guess.split('');

                    dom.possibleSolutions.textContent = "";

                    rowTiles.forEach((tile, index) => {
                        tile.classList.remove('success', 'danger');
                        const letter = guessLetters[index];
                        tile.querySelector('.guess-box-back').textContent = letter;

                        if (state.verticalList.includes(letter)) {
                            tile.querySelector('.guess-box-back').classList.add('text-vertical');
                        }

                        if (letter === targetLetters[index]) {
                            tile.classList.add('success');
                            targetLetters[index] = null;
                            if (letter !== " ") {
                                state.wordleBotList = state.wordleBotList.filter(word =>
                                    word.split("")[index] === letter
                                );
                            }
                        }
                    });

                    rowTiles.forEach((tile, index) => {
                        const letter = guessLetters[index];
                        if (!tile.classList.contains('success') && targetLetters.includes(letter)) {
                            tile.classList.add('danger');
                            const inTargetPos = targetLetters.indexOf(letter);
                            targetLetters[inTargetPos] = null;
                            if (letter !== " ") {
                                state.wordleBotList = state.wordleBotList.filter(word =>
                                    word.split("").some((wordLetter, i) => letter === wordLetter && i !== index)
                                );
                            }
                        } else if (!state.paddedTarget.split('').includes(letter) && letter !== " ") {
                            state.wordleBotList = state.wordleBotList.filter(word =>
                                !word.split("").some(wordLetter => letter === wordLetter)
                            );
                        }

                        setTimeout(() => {
                            tile.classList.add('flip');
                        }, index * 100);
                    });

                    const guessedLine = game.getLinesForStation(guess.trim());
                    if (game.shareLine(guess.trim())) {
                        document.querySelector(`#r${state.currentRow}`).classList.add('rightLine');
                        state.wordleBotList = state.wordleBotList.filter(word =>
                            game.shareLine(word, guessedLine)
                        );
                        state.wordleBotLines = [...guessedLine];
                    } else {
                        state.wordleBotList = state.wordleBotList.filter(word =>
                            !game.shareLine(word, guessedLine)
                        );
                        guessedLine.forEach(line => {
                            const index = state.wordleBotLines.indexOf(line);
                            if (index > -1) state.wordleBotLines.splice(index, 1);
                        });
                    }

                    if (state.wordleBotTargetLength === 0) {
                        if ((guess.trim().length === state.settings.minLength && guess.trim().length <= state.targetWord.length) ||
                            (guess.trim().length < state.targetWord.length)) {
                            state.wordleBotTargetLength = state.targetWord.length;
                            state.wordleBotList = state.wordleBotList.filter(word =>
                                word.trim().length === state.wordleBotTargetLength
                            );
                        }
                    }

                    state.wordleBotListDifferences = state.wordleBotTotalPossibleCount - state.wordleBotList.length;
                    if (state.isUselessGuess) {
                        showMessage(`此站已被排除`);
                    } else if (state.wordleBotListDifferences * 1.5 > state.wordleBotTotalPossibleCount) {
                        if (state.wordleBotTotalPossibleCount >= 100) {
                            showMessage(`摒除了<span class="hanLat">${state.wordleBotListDifferences}</span>站`);
                        } else if (state.wordleBotTotalPossibleCount < 20 && state.wordleBotListDifferences > 1) {
                            showMessage(`範圍已縮小至<span class="hanLat">${state.wordleBotTotalPossibleCount - state.wordleBotListDifferences}</span>站`);
                        }
                    }

                    game.runAlgo();

                    if (state.isGameOver) {
                        showMessage("恭喜");
                        setTimeout(() => {
                            game.loadConfetti();
                        }, (state.settings.maxLength + 1) * 100);
                        game.controlInputs(state.targetWord);
                        dom.wordleBotOutputContainer.classList.remove('display-none');
                        return;
                    }

                    state.currentRow++;
                    game.updateChances(state.userData.guess.length + 1);

                    if (state.currentRow >= state.settings.maxAttempts) {
                        showMessage(state.targetWord);
                        game.controlInputs(state.targetWord);
                        dom.wordleBotOutputContainer.classList.remove('display-none');
                        return;
                    }

                    game.createGridNew();
                },

                controlInputs(innerText = "") {
                    dom.inputField.placeholder = innerText;
                    dom.inputField.disabled = true;
                    dom.submitBtn.disabled = true;

                    const chancesUsed = state.currentRow + 1 > state.settings.maxAttempts ? 'X' : state.currentRow + 1;
                    const chancesLeft = state.currentRow + 1 > state.settings.maxAttempts ? 'X' : state.settings.maxAttempts - chancesUsed;

                    dom.gameOverTab.classList.remove('display-none');
                    dom.gameOverTab.querySelector('tbody').innerHTML += `
                <tr>
                    <td><span class="hanLat hl-r">${state.settings.minLength}</span>至<span class="hanLat hl-l">${state.settings.maxLength}</span></td>
                    <td><span class="hanLat hl-r">${chancesUsed}</span>之<span class="hanLat hl-l">${state.settings.maxAttempts}</span></td>
                    <td><span class="hanLat hl-r">${dom.selectedLines.querySelectorAll('.btn-fill').length}</span>條</td>
                </tr>
            `;
                    dom.chancesLabelNormal.innerHTML = `第<span class="hanLat">${chancesUsed}</span>之<span class="hanLat">${state.settings.maxAttempts}</span>次`;
                    dom.chancesLabelAlt.innerHTML = `餘<span class="hanLat">${chancesLeft}</span>次`;

                    game.generateCanvas();
                },

                loadConfetti() {
                    loadScript('https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js', () => {
                        if ((state.currentRow + 1) <= 3) {
                            const end = Date.now() + 2000;
                            (function frame() {
                                confetti({
                                    particleCount: 2,
                                    angle: randomInRange(50, 70),
                                    spread: randomInRange(50, 60),
                                    origin: { x: 0, y: randomInRange(0.4, 0.6) },
                                });
                                confetti({
                                    particleCount: 2,
                                    angle: randomInRange(110, 130),
                                    spread: randomInRange(50, 60),
                                    origin: { x: 1, y: randomInRange(0.4, 0.6) },
                                });
                                if (Date.now() < end) requestAnimationFrame(frame);
                            })();
                        } else if ((state.currentRow + 1) <= 5) {
                            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
                            confetti(Object.assign({}, defaults, {
                                particleCount: 50,
                                origin: { x: randomInRange(0.1, 0.3), y: randomInRange(0.6, 0.8) },
                            }));
                            confetti(Object.assign({}, defaults, {
                                particleCount: 50,
                                origin: { x: randomInRange(0.7, 0.9), y: randomInRange(0.6, 0.8) },
                            }));
                            confetti(Object.assign({}, defaults, {
                                particleCount: 100,
                                origin: { x: randomInRange(0, 0.2), y: randomInRange(0.1, 0.3) },
                            }));
                            confetti(Object.assign({}, defaults, {
                                particleCount: 100,
                                origin: { x: randomInRange(0.8, 1), y: randomInRange(0.1, 0.3) },
                            }));
                        } else {
                            confetti({
                                angle: 270,
                                spread: 400,
                                particleCount: 150,
                                origin: { x: 0.5, y: 0 },
                            });
                        }
                    })
                },

                generateCanvas() {
                    const config = {
                        maxLength: state.settings.maxLength,
                        attempts: Math.min(state.settings.maxAttempts, state.currentRow + 1),
                        cellSize: 50,
                        cellMargin: 10,
                        scaleFactor: 3,
                        font: 'ZutekSans',
                        fontSize: 30,
                        titleFontSize: 32,
                        contextFontSize: 12,
                        safeMargin: 24,
                        verticalGap: 6,
                        horizontalGap: 12,
                        minWidth: 400
                    };

                    const gameBoardWords = [];
                    const gameBoardDistribution = [];
                    const gameBoardFilled = [];
                    dom.genField.querySelectorAll('.guess-row').forEach(row => {
                        gameBoardFilled.push(row.classList.contains('rightLine'));
                        const rowTiles = [];
                        const rowDistribution = [];
                        row.querySelectorAll('.guess-box').forEach(tile => {
                            rowTiles.push(tile.querySelector('.guess-box-back').textContent);
                            rowDistribution.push(
                                tile.classList.contains('success') ? 2 :
                                    (tile.classList.contains('danger') ? 1 : 0)
                            );
                        });
                        gameBoardWords.push(rowTiles);
                        gameBoardDistribution.push(rowDistribution);
                    });

                    const style = window.getComputedStyle(document.body);
                    const colours = [
                        style.getPropertyValue('--border').trim(),
                        style.getPropertyValue('--danger').trim(),
                        style.getPropertyValue('--success').trim()
                    ];
                    const bgColour = style.backgroundColor;

                    const ctx = dom.gameCanvas.getContext('2d');
                    const totalWidth = config.cellSize * config.attempts + config.horizontalGap * (config.attempts - 1);
                    const totalHeight = config.cellSize * config.maxLength + config.verticalGap * (config.maxLength - 1);
                    const canvasWidth = totalWidth + config.safeMargin * 2;
                    const canvasHeight = totalHeight + config.titleFontSize + config.contextFontSize * 3 + config.safeMargin * 4;
                    const widthEmptySpace = Math.max(0, config.minWidth - canvasWidth);

                    dom.gameCanvas.width = (widthEmptySpace > 0 ? config.minWidth : canvasWidth) * config.scaleFactor;
                    dom.gameCanvas.height = canvasHeight * config.scaleFactor;

                    ctx.fillStyle = bgColour;
                    ctx.fillRect(0, 0, dom.gameCanvas.width, dom.gameCanvas.height);

                    let globalY = (config.titleFontSize / 2 + config.safeMargin) * config.scaleFactor;
                    ctx.fillStyle = style.getPropertyValue('--title-color').trim();
                    ctx.font = `bold ${config.titleFontSize * config.scaleFactor}px ${style.getPropertyValue('--title-font').trim()}`;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText("運 dle", dom.gameCanvas.width / 2, globalY);

                    globalY += (config.titleFontSize + config.contextFontSize + config.safeMargin) / 2 * config.scaleFactor;
                    ctx.fillStyle = style.getPropertyValue('--color').trim();
                    ctx.font = `${config.contextFontSize * config.scaleFactor}px ${style.getPropertyValue('--mono-font').trim()}`;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "alphabetic";
                    ctx.fillText(
                        `W[${state.settings.minLength},${state.settings.maxLength}]; C(${state.currentRow + 1 > state.settings.maxAttempts ? 'X' : state.currentRow + 1}/${state.settings.maxAttempts}); L(${dom.selectedLines.querySelectorAll('.btn-fill').length})`,
                        dom.gameCanvas.width / 2,
                        globalY
                    );

                    if (state.settings.enableBot) {
                        globalY += (config.contextFontSize + config.safeMargin / 4) * config.scaleFactor;
                        ctx.fillText(
                            `SKL(${dom.scoreSkill.textContent}%); LCK(${dom.scoreLuck.textContent}%)`,
                            dom.gameCanvas.width / 2,
                            globalY
                        );
                    } else {
                        globalY += config.contextFontSize / 2 * config.scaleFactor;
                    }

                    ctx.fillText(
                        `https://zutek3134.taipei/zh-tw/lab/yundle/`,
                        dom.gameCanvas.width / 2,
                        dom.gameCanvas.height - config.safeMargin * config.scaleFactor
                    );

                    const startX = config.safeMargin + (widthEmptySpace > 0 ? widthEmptySpace / 2 : 0);
                    const startY = config.safeMargin;
                    for (let len = 0; len < config.maxLength; len++) {
                        for (let att = config.attempts - 1; att >= 0; att--) {
                            const letter = gameBoardWords[att][len];
                            const stateVal = gameBoardDistribution[att][len];
                            const x = (startX + (config.attempts - att - 1) * (config.cellSize + config.horizontalGap)) * config.scaleFactor;
                            const y = globalY + (startY + len * (config.cellSize + config.verticalGap)) * config.scaleFactor;
                            let textFill = bgColour;

                            if (gameBoardFilled[att]) {
                                ctx.fillStyle = colours[stateVal];
                                ctx.fillRect(x, y, config.cellSize * config.scaleFactor, config.cellSize * config.scaleFactor);
                            } else {
                                ctx.strokeStyle = colours[stateVal];
                                ctx.lineWidth = 2 * config.scaleFactor;
                                ctx.strokeRect(x, y, config.cellSize * config.scaleFactor, config.cellSize * config.scaleFactor);
                                textFill = colours[stateVal];
                            }

                            ctx.fillStyle = textFill;
                            ctx.font = `bold ${config.fontSize * config.scaleFactor}px ${config.font}`;
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(
                                letter,
                                x + (config.cellSize * config.scaleFactor) / 2,
                                y + (config.cellSize * config.scaleFactor) / 2
                            );
                        }
                    }

                    const imageUrl = dom.gameCanvas.toDataURL("image/png");
                    dom.shareImg.src = imageUrl;
                    dom.shareImg.parentElement.href = imageUrl;
                },

                updateChances(cur) {
                    dom.chancesLabelNormal.innerHTML = `第<span class="hanLat">${cur}</span>之<span class="hanLat">${state.settings.maxAttempts}</span>次`;
                    dom.chancesLabelAlt.innerHTML = `餘<span class="hanLat">${state.settings.maxAttempts - cur + 1}</span>次`;
                }
            };

            function init() {
                const savedSettings = localStorage.getItem('wordleSettings');
                if (savedSettings) {
                    try {
                        const { maxLength, minLength, maxAttempts, selectedLines, enableHint, enableBot } = JSON.parse(savedSettings);
                        dom.maxWords.value = Math.min(maxLength, 6);
                        dom.minWords.value = Math.max(minLength, 2);
                        dom.maxAttempts.value = Math.min(Math.max(maxAttempts, 1), 12);

                        let enabledLineCount = 0;
                        dom.selectedLines.querySelectorAll('.btn').forEach(element => {
                            if (selectedLines.includes(element.getAttribute('data-name'))) {
                                element.classList.add('btn-fill');
                                enabledLineCount++;
                            } else {
                                element.classList.remove('btn-fill');
                            }
                        });
                        dom.chosenCount.textContent = enabledLineCount;
                        dom.inputHint.checked = enableHint;
                        if (enableBot) dom.wordleBotButton.classList.add('btn-fill');
                    } catch (err) {
                        console.error("Error loading settings:", err);
                    }
                }

                dom.inputField.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') game.handleEnter();
                });
                dom.submitBtn?.addEventListener('click', () => game.handleEnter());
                dom.selectedLines?.addEventListener('click', (e) => {
                    if (e.target.classList.contains('btn')) buttonToggle(e.target);
                });
                dom.wordleBotButton.addEventListener('click', (e) => {
                    buttonToggle(e.target);
                });

                window.openModal('gameSettings');
                window.handleEnterButton = game.handleEnter;
            }

            return {
                init,
                loadGame: game.loadGame
            };
        })();

        YundleGame.init();
        window.loadGame = YundleGame.loadGame;
    </script>
</body>

</html>