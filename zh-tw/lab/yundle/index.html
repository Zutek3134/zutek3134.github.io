<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運dle — Zutek’s Secret Warehouse</title>
    <meta name="description" content="運ㄉㄡˇ，捷運版本的中文 wordle，題庫涵蓋臺北、新北、桃園、臺中、高雄捷運及高鐵、臺鐵、港鐵。">
    <meta property="og:image" content="https://zutek3134.taipei/images/yundleBanner.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://zutek3134.taipei/images/yundleBanner.png">

    <link rel="icon" type="image/x-icon" href="/images/zeeb.png">
    <link rel="alternate" hreflang="zh" href="https://zutek3134.taipei/zh-tw/lab/wordle/" />
    <link href='/stylesheets/style.css' rel='stylesheet'>
    <link href='/stylesheets/mandarinSupport.css' rel='stylesheet'>
    <link href='/js/tabs/stylesheet.css' rel='stylesheet'>
    <link href='/js/details/stylesheet.css' rel='stylesheet'>
    <style>
        main {
            min-height: calc(100dvh - var(--nav-height));
        }

        #selectedLines details {
            padding: 0 var(--gap-half);
        }

        #selectedLines summary {
            font-size: 0.7em;
            margin: 0 calc(-1 * var(--gap-half));
        }

        #selectedLines .yundle-line-btns {
            margin: var(--gap-half) 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(8em, 1fr));
            gap: calc(var(--gap) * 0.3);
        }

        #selectedLines .yundle-line-btns .btn {
            white-space: nowrap;
            padding-left: 0;
            padding-right: 0;
        }

        .scrollRect {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: calc(-1 * var(--gap-half));
        }

        .guess {
            display: flex;
            flex-direction: row-reverse;
            width: 0;
            height: 0;
            max-width: 100%;
            overflow-x: auto;
            padding: var(--gap-half);
            --game-font-size: min(3rem, 10dvw);
            --gap: calc(var(--game-font-size) * 0.39);
            --gap-half: calc(var(--gap) * 0.5);
            --gap-quarter: calc(var(--gap-half) * 0.5);
            transition: width 0.5s ease-in-out, height 0.5s ease-in-out;
        }

        .guess .guess-row {
            margin: 0 var(--gap-quarter);
        }

        .guess-row {
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
        }

        .guess-row.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* .guess-row.visible.unfocus {
            opacity: 0.6;
        } */

        .guess-box {
            --state-colour: var(--border);
            min-width: calc(var(--game-font-size) + var(--gap));
            height: calc(var(--game-font-size) + var(--gap));
            margin: var(--gap-quarter);
            perspective: 1000px;
        }

        .guess-box.flip .guess-box-inner {
            transform: rotateY(180deg);
        }

        .guess-box-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .guess-row.rightLine .guess-box-back {
            --shadow-colour: var(--state-colour);
            background: var(--state-colour);
            color: var(--bg);
        }

        .guess-box.flip .guess-box-front {
            border-color: transparent;
        }

        .guess-box-back,
        .guess-box-front {
            background: transparent;
            border: calc(var(--game-font-size) * 0.04) solid var(--state-colour);
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        .guess-box-front {
            --state-colour: var(--border-half);
        }

        .guess-box-back {
            transform: rotateY(180deg);
            line-height: calc(var(--game-font-size) + var(--gap) * 0.75);
            font-size: var(--game-font-size);
            font-weight: 700;
            color: var(--state-colour);
            box-shadow: 0 0 10px var(--shadow-colour);
        }

        .guess-box.success {
            --state-colour: var(--success);
        }

        .guess-box.danger {
            --state-colour: var(--danger);
        }

        .typeArea {
            position: relative;
            display: flex;
            justify-content: center;
        }

        .typeArea input {
            width: 100%;
            padding: var(--gap-half);
            background: var(--card-bg);
            font-size: 1.25rem;
        }

        #settings input {
            font-family: var(--mono-font);
        }

        .typeArea .submitBtn {
            --btn-theme: var(--card-bg);
            color: var(--color);
            border-width: 1px;
        }

        .typeArea .submitBtn:not([disabled]):hover {
            color: var(--bg);
        }

        .typeArea .submitBtn:focus {
            border-color: var(--border);
        }

        .typeArea input:disabled {
            background: var(--bg);
            border-color: var(--card-bg);
        }

        #settings>.item {
            display: flex;
        }

        #settings h3 {
            margin: var(--gap-half);
        }

        #settings input {
            margin: auto;
            min-width: 3em;
        }

        #settings .btn:not(.btn-fill):not(.disabled):not([disabled]):hover {
            --btn-bg: var(--danger);
        }

        #tut {
            flex-direction: row;
            display: flex;
            overflow-x: auto;
            padding: var(--gap-half);
            --game-font-size: min(6dvw, 3rem);
        }

        hr {
            margin-bottom: 1em;
        }

        .vr {
            border-left: 1px dashed var(--border);
            height: 2em;
        }

        .game-nav {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            padding: var(--gap-half);
            justify-content: center;
            align-items: center;
            gap: var(--gap-half);
        }

        .game-nav h1 {
            margin: 0;
        }

        .game-nav-actions {
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
        }

        .game-nav-actions>a {
            padding: 0.5em 1em;
        }

        .game-nav-actions>a:hover {
            background-color: var(--card-bg);
        }

        .game-nav-actions #question {
            font-weight: 700;
        }

        .game-nav #led {
            width: 100%;
            height: 100%;
            background-color: var(--bg-dark);
            border-radius: var(--gap-half);
            position: relative;
            overflow: hidden;
        }

        .game-nav #led p {
            position: absolute;
            left: 100%;
            top: 25%;
            margin: 0;
            text-wrap: nowrap;
            transition: left 6s linear;
        }

        .game-nav #led p.enter {
            left: -100%;
        }

        #chances-label #alt {
            display: none;
        }

        #chances-label[data-mode="alt"] #normal {
            display: none;
        }

        #chances-label[data-mode="alt"] #alt {
            display: inline;
        }

        #score-skill::before {
            content: '安全係數';
        }

        #score-luck::before {
            content: '幸運指數';
        }

        .scoreArea::before {
            display: block;
            color: var(--primary);
            font-size: 0.7em;
            opacity: 0.7;
        }

        .scoreArea::after {
            content: '%';
            margin-left: 0.2em;
            font-size: 0.6em;
        }

        #wordleBotOutput sub {
            vertical-align: baseline;
            font-size: 0.7em;
            margin-left: 0.4em;
        }

        .wordleBotDetailsIcon {
            --alert-icon: url('data: image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5"></path></svg>');
        }

        @media only screen and (max-width: 600px) {
            .game-nav {
                grid-template-columns: 1fr;
            }

            .game-nav h1 {
                text-align: center;
            }

            .game-nav-actions {
                justify-content: center;
            }

            .game-nav #led {
                height: 2.5rem;
            }

            .game-nav #led p {
                top: 0.625rem;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
    <script src="/js/modal/script.js"></script>
</head>

<body>
    <nav id="nav-placeholder" data-qr="true"></nav>
    <div id="modal-gameSettings" class="modal" data-onclose="loadGame">
        <div class="content show">
            <div class="header">
                <span class="close" onclick="closeModal()"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12 6.47 2 12 2m3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"></path>
                        </svg></span></span>
                <h2>運<span class="hanLat hl-l">dle</span></h2>
            </div>
            <div class="body">
                <h2>壹、設定</h2>
                <div class="row mar-b-2" id="settings">
                    <div class="item">
                        <h3 class="text-nowrap">最少</h3>
                        <input type="number" id="minWords" class="width-full" placeholder="預設：2" min="2" max="6" value="2">
                        <h3 class="text-nowrap">字，最多</h3>
                        <input type="number" id="maxWords" class="width-full" placeholder="預設：6" min="2" max="6" value="6">
                        <h3 class="text-nowrap">字</h3>
                    </div>
                    <div class="item">
                        <h3 class="text-nowrap">遊戲機會</h3>
                        <input type="number" id="maxAttempts" class="width-full" placeholder="預設：6" min="1" max="12" value="6">
                        <h3 class="text-nowrap">次</h3>
                    </div>
                    <label class="item-width">
                        <label class="switch-holder mar-l-05"><label class="switch">
                                <input type="checkbox" id="inputHint">
                                <span class="slider"></span>
                            </label>
                            <h3 class="switch-name">輸入建議</h3>
                        </label>
                    </label>
                    <div class="item-full">
                        <h3>路線範圍（<span id="chosenCount" class="hanLat hl-r">8</span>條）</h3>
                        <div id="selectedLines" class="pad-rl-05">
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji" src="logo/tpe.svg" draggable="false"><img class="twemoji mar-0" src="logo/ntpe.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn btn-fill" data-name="tpe-br" onclick="buttonToggle(this)">文湖線</button>
                                    <button class="btn btn-fill" data-name="tpe-r" onclick="buttonToggle(this)">淡水信義線</button>
                                    <button class="btn btn-fill" data-name="tpe-g" onclick="buttonToggle(this)">松山新店線</button>
                                    <button class="btn btn-fill" data-name="tpe-o" onclick="buttonToggle(this)">中和新蘆線</button>
                                    <button class="btn btn-fill" data-name="tpe-bl" onclick="buttonToggle(this)">板南線</button>
                                    <button class="btn btn-fill" data-name="ntpe-y" onclick="buttonToggle(this)">新北環狀線</button>
                                    <button class="btn btn-fill" data-name="ntpe-v" onclick="buttonToggle(this)">淡海輕軌</button>
                                    <button class="btn btn-fill" data-name="ntpe-k" onclick="buttonToggle(this)">安坑輕軌</button>
                                    <button class="btn" data-name="ntpe-lb" onclick="buttonToggle(this)">三鶯線</button>
                                    <button class="btn" data-name="tpe-lg" onclick="buttonToggle(this)">萬大中和線</button>
                                    <button class="btn" data-name="tpe-mk" onclick="buttonToggle(this)">貓空纜車</button>
                                </div>
                            </details>
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji" src="logo/tyn.svg" draggable="false"><img class="twemoji" src="logo/tch.svg" draggable="false"><img class="twemoji mar-0" src="logo/khs.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn" data-name="tyn-a" onclick="buttonToggle(this)">桃園機場線</button>
                                    <button class="btn" data-name="tyn-g" onclick="buttonToggle(this)">桃園綠線</button>
                                    <button class="btn" data-name="tch-1" onclick="buttonToggle(this)">烏日文心北屯線</button>
                                    <button class="btn" data-name="khs-r" onclick="buttonToggle(this)">高雄紅線</button>
                                    <button class="btn" data-name="khs-o" onclick="buttonToggle(this)">高雄橘線</button>
                                    <button class="btn" data-name="khs-c" onclick="buttonToggle(this)">高雄環狀輕軌</button>
                                </div>
                            </details>
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji" src="logo/thsr.svg" draggable="false"><img class="twemoji invert-in-night" src="logo/tr.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn" data-name="tw-hsr" onclick="buttonToggle(this)">臺灣高速鐵路</button>
                                    <button class="btn" data-name="tw-r-northern" onclick="buttonToggle(this)">西部幹線北段</button>
                                    <button class="btn" data-name="tw-r-mountain" onclick="buttonToggle(this)">西部幹線山線</button>
                                    <button class="btn" data-name="tw-r-coast" onclick="buttonToggle(this)">西部幹線海線</button>
                                    <button class="btn" data-name="tw-r-southern" onclick="buttonToggle(this)">西部幹線南段</button>
                                    <button class="btn" data-name="tw-r-pingtung" onclick="buttonToggle(this)">西部幹線屏東線</button>
                                    <button class="btn" data-name="tw-r-yilan" onclick="buttonToggle(this)">東部幹線宜蘭線</button>
                                    <button class="btn" data-name="tw-r-bayhuay" onclick="buttonToggle(this)">東部幹線北迴線</button>
                                    <button class="btn" data-name="tw-r-taitung" onclick="buttonToggle(this)">東部幹線臺東線</button>
                                    <button class="btn" data-name="tw-r-nanhuay" onclick="buttonToggle(this)">南迴線</button>
                                    <button class="btn" data-name="tw-r-shunau" onclick="buttonToggle(this)">深澳支線</button>
                                    <button class="btn" data-name="tw-r-pinghsi" onclick="buttonToggle(this)">平溪支線</button>
                                    <button class="btn" data-name="tw-r-nanwan" onclick="buttonToggle(this)">內灣／六家支線</button>
                                    <button class="btn" data-name="tw-r-jiji" onclick="buttonToggle(this)">集集支線</button>
                                    <button class="btn" data-name="tw-r-shalwun" onclick="buttonToggle(this)">沙崙支線</button>
                                </div>
                            </details>
                            <details class="alert-quote details-no-icon expanded" open>
                                <summary><img class="twemoji mar-0" src="logo/hkmtr.svg" draggable="false"></summary>
                                <div class="yundle-line-btns">
                                    <button class="btn" data-name="hk-eal" onclick="buttonToggle(this)">東鐵綫</button>
                                    <button class="btn" data-name="hk-ktl" onclick="buttonToggle(this)">觀塘綫</button>
                                    <button class="btn" data-name="hk-twl" onclick="buttonToggle(this)">荃灣綫</button>
                                    <button class="btn" data-name="hk-isl" onclick="buttonToggle(this)">港島綫</button>
                                    <button class="btn" data-name="hk-tcl" onclick="buttonToggle(this)">東涌綫</button>
                                    <button class="btn" data-name="hk-tkl" onclick="buttonToggle(this)">將軍澳綫</button>
                                    <button class="btn" data-name="hk-drl" onclick="buttonToggle(this)">迪士尼綫</button>
                                    <button class="btn" data-name="hk-sil" onclick="buttonToggle(this)">南港島綫</button>
                                    <button class="btn" data-name="hk-tml" onclick="buttonToggle(this)">屯馬綫</button>
                                    <button class="btn" data-name="hk-ael" onclick="buttonToggle(this)">機場快綫</button>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
                <h2>貳、玩法</h2>
                <div class="mar-b-3">
                    <p>每次答題時，框框及底色會標示其及目標車站之差異。字數、機會、範圍等均可自上方設定中自行調整。</p>
                    <hr />
                    <div class="guess-row visible" id="tut">
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    東
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    門
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，可由「<span class="hanLat hl-r">1</span>灰框」及「<span class="hanLat hl-r">5</span>綠框」推得以下線索：</p>
                    <ol class="informal">
                        <li>目標車站僅有<span class="hanLat">2</span>字，因有<span class="hanLat">4</span>空格為綠框；</li>
                        <li>目標車站之第二字為「門」，因「門」字為綠框；</li>
                        <li>目標車站並非位於「淡水信義線」或「中和新蘆線」，因底色非塗滿。</li>
                    </ol>
                    <p>綜上，目標車站可能為「北門」或「西門」，非「小南門」。</p>
                    <hr />
                    <div class="guess-row visible" id="tut">
                        <div class="guess-box flip danger">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    海
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip danger">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    山
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，可獲得以下資訊：</p>
                    <ol class="informal">
                        <li>目標車站僅有<span class="hanLat">4</span>字；</li>
                        <li>目標車站包含「海」、「山」二字，但目前位置錯誤；</li>
                        <li>目標車站並非位於「板南線」。</li>
                    </ol>
                    <p>綜上，目標車站可能為「濱海義山」。</p>
                    <hr />
                    <div class="guess-row visible rightLine" id="tut">
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    南
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    港
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    展
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    覽
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    館
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，可獲得以下資訊：</p>
                    <ol class="informal">
                        <li>目標車站不超過<span class="hanLat">5</span>字；</li>
                        <li>目標車站首二字為「南港」；</li>
                        <li>目標車站位於「板南線」或「文湖線」。</li>
                    </ol>
                    <p>綜上，目標車站可能為「南港」，非「南港軟體園區」。</p>
                    <hr />
                    <div class="guess-row visible rightLine" id="tut">
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    劍
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                    潭
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                        <div class="guess-box flip success">
                            <div class="guess-box-inner">
                                <div class="guess-box-back">
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>如上，所有格子皆為綠底，表示已猜出目標車站，恭喜過關。</p>
                </div>
                <h2>參、聲明</h2>
                <p class="indent">本遊戲<q class="books">運<span class="hanLat hl-l">dle</span></q>的製作，蓋受到知名網路工程師<u>喬許・華德爾</u>之<q class="books"><a class="inlineLink" href="https://www.nytimes.com/games/wordle/index.html" target="_blank">Wordle</a></q>影響及啟發。本遊戲目的為提供在地化及新奇的遊戲體驗，無侵權、營利之意圖。本遊戲題庫為開發者自行至官方或第三公共資源手動擷取之，不存在大量濫用或占用資源行為。本遊戲僅於瀏覽紀錄中儲存設定選項，不收集使用者資料。本遊戲由<span class="hanLat">Zutek 3134</span>獨立開發而成，且不熟悉之題庫內容亦已交由同好覆覈。</p>
                <p class="indent">本遊戲也特地開發<q>運斗ㄟㄞ</q>，同為<span class="hanLat">Zutek 3134</span>所獨立製作。原用於學習、推理、篩選最佳解答以快速縮小潛在答案範圍，進而有效地破關；後另兼分析使用者答案之功能，判斷其中之策略謀劃及運氣成分。如欲體驗，請將下方選項開啟，運斗ㄟㄞ將於遊戲結束時產出一份報告。</p>
                <div class="row">
                    <div id="wordleBotButton" class="item btn btn-secondary" onclick="buttonToggle(this)"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5" />
                            </svg></span>啟用<q>運斗ㄟㄞ</q>智慧分析</div>
                </div>
                <p class="indent">為避免遊戲從推理變質為套公式，強烈建議使用者於開啟上方選項前自行摸索遊戲，找出自己破關的規律，並享受過程，而非一昧帶入、背誦答案。開發者認為，這是機器人才該做的事情，故先行上刀山下火海地訓練出<q>運斗ㄟㄞ</q>。當使用者已準備好挑戰ㄟㄞ，便可開啟選項，與之一較高下。</p>
                <p class="indent">敬祝　遊戲愉快</p>
            </div>
            <div class="footer">
                <p class="text-centre">關閉此頁面後，直至下次遊戲前，皆不得再編輯。</p>
            </div>
        </div>
    </div>
    <div id="modal-qrcode" class="modal">
        <div class="content show">
            <div class="header">
                <span class="close" onclick="closeModal()"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12 6.47 2 12 2m3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"></path>
                        </svg></span></span>
                <h2><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M4 4h6v6H4zm16 0v6h-6V4zm-6 11h2v-2h-2v-2h2v2h2v-2h2v2h-2v2h2v3h-2v2h-2v-2h-3v2h-2v-4h3zm2 0v3h2v-3zM4 20v-6h6v6zM6 6v2h2V6zm10 0v2h2V6zM6 16v2h2v-2zm-2-5h2v2H4zm5 0h4v4h-2v-2H9zm2-5h2v4h-2zM2 2v4H0V2a2 2 0 0 1 2-2h4v2zm20-2a2 2 0 0 1 2 2v4h-2V2h-4V0zM2 18v4h4v2H2a2 2 0 0 1-2-2v-4zm20 4v-4h2v4a2 2 0 0 1-2 2h-4v-2z" />
                        </svg></span>分享此遊戲</h2>
            </div>
            <div class="body">
                <div style="display: flex; flex-direction: column;">
                    <img src="share_nightTheme.svg" class="hide-in-light" draggable="false" loading="lazy" style="margin: auto;max-width: 60dvw;max-height: 60dvh;">
                    <img src="share_lightTheme.svg" class="hide-in-night" draggable="false" loading="lazy" style="margin: auto;max-width: 60dvw;max-height: 60dvh;">
                    <p class="text-centre"><a class="inlineLink" href="https://zutek3134.taipei/zh-tw/lab/yundle/"><code>https://zutek3134.taipei/zh-tw/lab/yundle/</code></a></p>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-gameOverShare" class="modal">
        <div class="content show">
            <div class="header">
                <span class="close" onclick="closeModal()"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12 6.47 2 12 2m3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"></path>
                        </svg></span></span>
                <h2>分享結果<span class="text-small">（點擊圖片即可放大）</span></h2>
            </div>
            <div class="body">
                <div class="text-centre">
                    <a draggable="false"><img id="shareImg" src="" class="bordered rounded attachment" draggable="false"></a>
                </div>
            </div>
        </div>
    </div>
    <main>
        <div class="container">
            <div class="game-nav">
                <h1>運<span class="hanLat hl-l">dle</span></h1>
                <div class="game-nav-actions">
                    <a href="/metro/" target="_blank">捷運小工具<span class="twemoji" style="font-size: 0.7em; margin: 0 0 0 0.3em; vertical-align: middle;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                <path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2m6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.75.75 0 0 1-1.042-.018.75.75 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1" />
                            </svg></span></a>
                    <div class="vr"></div>
                    <a id="chances-label" data-mode="normal" onclick="this.dataset.mode = this.dataset.mode === 'normal' ? 'alt' : 'normal'"><span id="normal">第 1 之 6 次</span><span id="alt">餘 5 次</span></a>
                    <div class="vr"></div>
                    <a id="question" onclick="openModal('gameSettings')">？</a>
                </div>
                <div id="led"></div>
                <div class="typeArea">
                    <input list="guessesList" type="text" id="inputField" placeholder="輸入車站名稱" style="border-radius: var(--gap-half) 0 0 var(--gap-half);">
                    <button class="btn btn-fill submitBtn" onclick="handleEnterButton()" style="border-radius: 0 var(--gap-half) var(--gap-half) 0;"><span class="twemoji" style="margin-right: 0.1em;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4" />
                            </svg></span></button>
                </div>
            </div>
            <hr>
            <p class="text-centre display-none" style="opacity: 0.7"><span id="game-curRow" class="hanLat hl-r">1</span>之<span id="game-totalChances" class="hanLat hl-l">6</span></p>
            <div class="scrollRect">
                <div class="guess" id="genField">
                </div>
            </div>
            <div id="gameOverTab" class="text-centre width-full mar-t-1 display-none">
                <div>
                    <button id="shareBtn" class="btn btn-fill" style="margin-right: var(--gap)" onclick="openModal('gameOverShare');"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="m21 12-7-7v4C7 10 4 15 3 20c2.5-3.5 6-5.1 11-5.1V19z" />
                            </svg></span>分享結果</button>
                    <button id="replayBtn" class="btn" onclick="location.reload();"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 4c2.1 0 4.1.8 5.6 2.3 3.1 3.1 3.1 8.2 0 11.3-1.8 1.9-4.3 2.6-6.7 2.3l.5-2c1.7.2 3.5-.4 4.8-1.7 2.3-2.3 2.3-6.1 0-8.5C15.1 6.6 13.5 6 12 6v4.6l-5-5 5-5zM6.3 17.6C3.7 15 3.3 11 5.1 7.9l1.5 1.5c-1.1 2.2-.7 5 1.2 6.8q.75.75 1.8 1.2l-.6 2q-1.5-.6-2.7-1.8" />
                            </svg></span>再玩一次</button>
                </div>
                <div class="table-container mar-t-1">
                    <table>
                        <tr>
                            <th style="width: 33%;">字數</th>
                            <th style="width: 33%;">機會</th>
                            <th style="width: 33%;">路線</th>
                        </tr>
                    </table>
                </div>
            </div>

            <canvas id="gameCanvas" style="display: none;"></canvas>
        </div>
        <div class="container display-none" id="wordleBotOutputContainer">
            <details class="wordleBotDetailsIcon">
                <summary>運斗ㄟㄞ研究室</summary>
                <div>
                    <div class="row">
                        <div class="item">
                            <p class="mar-0 display text-centre"><span class="scoreArea" id="score-skill">0</span></p>
                        </div>
                        <div class="item">
                            <p class="mar-0 display text-centre"><span class="scoreArea" id="score-luck">0</span></p>
                        </div>
                    </div>
                    <div class="table-container mar-t-1">
                        <table id="wordleBotOutput" class="text-centre">
                            <tr>
                                <th style="width: 6em;">所猜站名</th>
                                <th style="width: 4em;">安全係數</th>
                                <th style="width: 4em;">幸運指數</th>
                                <th style="width: 4em;">潛在答案數量</th>
                                <th style="width: 10em;">ㄟㄞ首選</th>
                                <th style="width: 10em;">ㄟㄞ次選</th>
                            </tr>
                        </table>
                    </div>
                </div>
            </details>
        </div>
        <div class="container display-none">
            <div class="card">
                <div class="title">
                    <h3 class="mar-0 text-centre">作弊不可取</h3>
                </div>
                <div class=" body">
                    <!-- 請勿作弊，作弊可恥 -->
                    <p id="possibleSolutions" class="mar-0"></p>
                </div>
            </div>
        </div>
    </main>
    <footer id="footer-placeholder"></footer>
    <script src="/includes/includes.js" data-comments></script>
    <script src="/js/tabs/script.js"></script>
    <script src="/js/details/script.js"></script>
    <script src="/js/autocomplete/script.js"></script>
    <script>
        function buttonToggle(element) {
            if (element.classList.contains('disabled'))
                return;

            element.classList.toggle('btn-fill');

            document.querySelector('#chosenCount').textContent = document.querySelectorAll('#selectedLines .btn-fill').length;
        }

        const ledHolder = document.getElementById('led');
        let ledTimers = [];
        let ledMsg;

        function showMessage(msg) {
            if (ledMsg) {
                ledTimers.forEach(timer => clearTimeout(timer));
                ledMsg.remove();
                ledMsg = null;
            }

            const newLedMsg = document.createElement('p');
            newLedMsg.innerHTML = msg;
            ledHolder.appendChild(newLedMsg);

            ledMsg = newLedMsg;

            ledTimers[0] = setTimeout(() => {
                ledMsg.classList.add('enter');

                ledTimers[1] = setTimeout(() => {
                    ledMsg.remove();
                    ledMsg = null;
                }, 6500);
            }, 100);
        }

        var handleEnterButton;

        function loadGame() {
            const gameSettingsModal = document.getElementById('modal-gameSettings');
            gameSettingsModal.removeAttribute('data-onclose');
            const formElements = gameSettingsModal.querySelectorAll('input, .btn');
            formElements.forEach(element => {
                element.disabled = true;
                element.classList.add('disabled');
            });

            const minLength = Math.max(document.querySelector('#minWords').value, 2);
            const maxLength = Math.min(document.querySelector('#maxWords').value, 6);
            const maxAttempts = Math.min(Math.max(document.querySelector('#maxAttempts').value, 1), 12);
            const selectedLinesElements = Array.from(document.querySelectorAll(`#selectedLines .btn-fill`));
            let selectedLines = [];
            const enableHint = document.querySelector('#inputHint').checked;
            const enableBot = document.querySelector('#wordleBotButton').classList.contains('btn-fill');
            if (!enableBot)
                document.getElementById('wordleBotOutputContainer').style.display = "none";

            selectedLinesElements.forEach((element) => {
                selectedLines.push(element.getAttribute('data-name'));
            })

            const settings = {
                maxLength,
                minLength,
                maxAttempts,
                selectedLines,
                enableHint,
                enableBot
            };
            localStorage.setItem('wordleSettings', JSON.stringify(settings));

            let currentRow = 0;
            let fullData = [];
            let wordList = [];
            let targetWord = "";
            let paddedTarget = "";
            let targetLine = [];

            let isGameOver = false;
            let isUselessGuess = false;
            let userData = { skill: [], luck: [], guess: [], botGuess: [] };

            let wordleBotList = [];
            let wordleBotLines = [];
            let wordleBotAnalysis = [];
            let wordleBotListDifferences = 0;
            let wordleBotTotalPossibleCount = 0;
            let wordleBotTargetLength = 0;

            const grid = document.getElementById('genField');
            const inputField = document.getElementById('inputField');
            const submitBtn = document.querySelector('button.submitBtn');

            const labelChancesNormal = document.querySelector('#chances-label #normal');
            const labelChancesAlt = document.querySelector('#chances-label #alt');

            function updateChances(cur) {
                labelChancesNormal.innerHTML = '第<span class="hanLat">' + cur + '</span>之<span class="hanLat">' + maxAttempts + '</span>次';
                labelChancesAlt.innerHTML = '餘<span class="hanLat">' + (maxAttempts - cur + 1) + '</span>次';
            }
            updateChances(1);

            const scoreSkill = document.getElementById('score-skill');
            const scoreLuck = document.getElementById('score-luck');
            const wordleBotGuesses = document.getElementById('possibleSolutions');
            const wordleBotOutput = document.getElementById('wordleBotOutput');

            document.getElementById('game-totalChances').textContent = maxAttempts;

            const replaceList = {
                "七哩岸": "唭哩岸",
                "廣慈奉天宮": "廣慈／奉天宮",
                "中坡": "廣慈／奉天宮",
                "林光": "麟光",
                "下安": "廈安",
                "高樓大廈安": "廈安",
                "夏安": "廈安",
                "新是一路": "新市一路",
                "海珊": "海山",
                "聯城錦和": "連城錦和",
                "聯成錦和": "連城錦和",
                "連成錦和": "連城錦和",
                "新店市公所": "新店區公所"
            };

            const verticalList = ["（", "）"];

            async function loadDictionary() {
                const response = await fetch("data.json");
                fullData = await response.json();
                wordList = Object.keys(fullData).filter(function (word) {
                    return word.length >= minLength && word.length <= maxLength && fullData[word].some((line) => selectedLines.includes(line));
                });
                selectRandomWord();
            }

            function selectRandomWord() {
                if (wordList.length <= 0) {
                    showMessage("設定有誤");
                    controlInputs();
                    return;
                }

                const randomIndex = Math.floor(Math.random() * wordList.length + Date.now() % wordList.length) % wordList.length;
                targetWord = wordList[randomIndex];
                // targetWord = "忠孝新生";
                paddedTarget = targetWord.padEnd(maxLength, ' ');
                targetLine = getLinesForStation(targetWord);

                if (enableHint) {
                    const inputField = document.getElementById('inputField');
                    let sortWordList = Array.from(wordList);
                    sortWordList.sort((a, b) => {
                        if (a.length !== b.length) return a.length - b.length;
                        return a.localeCompare(b, 'zh-Hant');
                    });
                    setupAutocomplete(inputField, sortWordList);
                }

                wordleBotList = Array.from(wordList);
                wordleBotList.forEach((word, index) => wordleBotList[index] = word.padEnd(maxLength, ' '));
                wordleBotLines = Array.from(selectedLines);
                wordleBotTotalPossibleCount = wordleBotList.length;
                runAlgo();
            }

            function getLinesForStation(name) {
                return fullData[name.trim()].filter(line => selectedLines.includes(line)) || [];
            }

            function shareLine(station, line = targetLine) {
                const guessline = getLinesForStation(station.trim());
                return line.some(line => guessline.includes(line));
            }

            function runAlgo() {
                const isItLuckTime = wordleBotAnalysis.length > 0 && wordleBotAnalysis[0].score === wordleBotAnalysis[wordleBotAnalysis.length - 1].score;

                if (userData['guess'].length > 0) {
                    let curScore;

                    if ((wordleBotListDifferences === 0 && !isGameOver) || (isUselessGuess)) {
                        curScore = 0;
                    }
                    else if (isItLuckTime) {
                        curScore = -1;
                    }
                    else {
                        const guess = userData['guess'][currentRow].trim();
                        wordleBotAnalysis.every(obj => {
                            if (obj['word'].trim() === guess) {
                                curScore = 99 * obj['score'] / wordleBotAnalysis[0]['score'];
                                return false;
                            }
                            return true;
                        });
                        curScore = Math.round(curScore * 10) / 10;
                    }
                    userData['skill'].push(curScore);

                    if (userData['skill'].length > 0) {
                        let fullScore = 0;
                        let skillNull = 0;
                        userData['skill'].forEach(s => {
                            if (s >= 0)
                                fullScore += s;
                            else
                                skillNull++;
                        });
                        fullScore = Math.round(fullScore / (userData['skill'].length - skillNull) * 10) / 10;
                        scoreSkill.textContent = fullScore;
                    } else {
                        scoreSkill.textContent = '--';
                    }
                }

                wordleBotAnalysis = new Array(wordleBotList.length);

                const letterFrequency = {};
                const lineFrequency = {};
                let transferStationCount = 0;

                wordleBotList.forEach(word => {
                    for (const letter of word) {
                        letterFrequency[letter] = (letterFrequency[letter] || 0) + (letter === " " ? (wordleBotTargetLength === 0 ? 1 : 0) : 1);
                    }

                    const lines = getLinesForStation(word);
                    for (const line of lines) {
                        lineFrequency[line] = (lineFrequency[line] || 0) + 1;
                    }

                    if (lines.length > 1) transferStationCount++;
                });

                const lineFreqArr = Object.keys(lineFrequency).map((key) => [key, lineFrequency[key]]).sort((a, b) => b[1] - a[1]);
                const lineWithMostSta = lineFreqArr[0];
                const remainingLines = wordleBotLines.length;
                const lineMedianSta = calculateMedian(Object.values(lineFrequency));
                const threshold = lineWithMostSta[1] > 1;
                const letterWeight = (threshold && transferStationCount > 0) ? 0.7 : 1;
                const lineWeight = ((remainingLines > 2 || transferStationCount === 0) && (lineWithMostSta[1] > 1)) ? threshold ? 1 : 0.5 : 0;

                wordleBotList.forEach((word, index) => {
                    let score = 0;

                    for (const letter of word) {
                        score += (letterFrequency[letter] || 0) * letterWeight;
                    }

                    const lines = getLinesForStation(word);
                    lines.forEach(line => {
                        if (lines.length < 2 && !threshold)
                            return;

                        const mostStaLine = (line === lineWithMostSta[0]) && threshold ? 2 : 1;
                        score += (lineFrequency[line] || 0) * lineWeight * mostStaLine;
                    });

                    score = Math.round(score);

                    wordleBotAnalysis[index] = { word, score };
                });

                wordleBotAnalysis.sort((a, b) => b.score - a.score);

                //console.log(wordleBotAnalysis);

                function calculateMedian(arr) {
                    const sorted = [...arr].sort((a, b) => a - b);
                    const mid = Math.floor(sorted.length / 2);
                    return sorted.length % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];
                }

                if (userData['guess'].length > 0) {
                    if (wordleBotTotalPossibleCount > 1) {
                        let curLuck = -1;

                        if (wordleBotListDifferences === 0) {
                            curLuck = 0;
                        }
                        else if (isItLuckTime && !isUselessGuess) {
                            curLuck = isGameOver ? 100 : 0;
                        }
                        else {
                            curLuck = (1 - ((wordleBotList.length - 1) / wordleBotTotalPossibleCount)) * 100;
                        }

                        curLuck = Math.round(curLuck * 10) / 10;
                        userData['luck'].push(curLuck);

                        let fullLuck = 0;
                        let luckNull = 0;
                        userData['luck'].forEach(s => {
                            if (s >= 0)
                                fullLuck += s;
                            else
                                luckNull++
                        });
                        fullLuck = Math.round(fullLuck / (userData['luck'].length - luckNull) * 10) / 10;
                        scoreLuck.textContent = fullLuck;
                    }

                    wordleBotTotalPossibleCount = wordleBotList.length;

                    const skillString = userData['skill'][currentRow] >= 0 ? ` scoreArea">${userData['skill'][currentRow]}` : '">--';
                    const luckString = userData['luck'][currentRow] >= 0 ? ` scoreArea">${userData['luck'][currentRow]}` : '">--';
                    const potentialString = !isGameOver ? `${wordleBotTotalPossibleCount} <sub>-${wordleBotListDifferences}</sub>` : '--';
                    const wordleBotGuessRow = userData['botGuess'][currentRow][1] != "" ? `<td>${userData['botGuess'][currentRow][0]}</td><td>${userData['botGuess'][currentRow][1]}</td>` : `<td colspan="2">${userData['botGuess'][currentRow][0]}`;
                    wordleBotOutput.innerHTML += `
                        <tr>
                            <td class="text-nowrap">${userData['guess'][currentRow]}</td>
                            <td class="text-nowrap${skillString}</td>
                            <td class="text-nowrap${luckString}</td>
                            <td>${potentialString}</td>
                            ${wordleBotGuessRow}
                        </tr>
                        `;
                }

                let bestOptions = new Array();
                let optionIndex = 0;
                let optionScore = 0;
                for (let index = optionIndex; index < wordleBotAnalysis.length; index++) {
                    if (wordleBotAnalysis[index].score < optionScore)
                        break;

                    optionIndex = index;
                    bestOptions.push(`<span class="text-nowrap">${wordleBotAnalysis[index].word.trim()}</span>`);
                    optionScore = wordleBotAnalysis[index].score;
                }
                optionIndex++;

                let runnerUpOptions = new Array();
                for (let index = optionIndex; index < Math.min(4, wordleBotAnalysis.length); index++) {
                    runnerUpOptions.push(`<span class="text-nowrap">${wordleBotAnalysis[index].word.trim()}</span>`);
                }

                userData['botGuess'].push([bestOptions.join('、'), runnerUpOptions.join('、')]);
                // console.log(wordleBotAnalysis[0].word, wordleBotAnalysis, userData);
            }

            function createGrid() {
                for (let i = 0; i < maxAttempts; i++) {
                    const row = document.createElement('div');
                    row.classList.add('guess-row');
                    row.id = `r${i}`;
                    for (let j = 0; j < maxLength; j++) {
                        const tile = document.createElement('div');
                        tile.classList.add('guess-box');
                        tile.setAttribute('data-row', i);
                        tile.setAttribute('data-col', j);

                        const tileInner = document.createElement('div');
                        tileInner.classList.add('guess-box-inner');

                        const tileFront = document.createElement('div');
                        tileFront.classList.add('guess-box-front');

                        const tileBack = document.createElement('div');
                        tileBack.classList.add('guess-box-back');

                        tileInner.appendChild(tileBack);
                        tileInner.appendChild(tileFront);
                        tile.appendChild(tileInner);
                        row.appendChild(tile);
                    }
                    grid.appendChild(row);
                }
            }

            function createGridNew() {
                const row = document.createElement('div');
                row.classList.add('guess-row');
                row.id = `r${currentRow}`;
                for (let j = 0; j < maxLength; j++) {
                    const tile = document.createElement('div');
                    tile.classList.add('guess-box');
                    tile.setAttribute('data-row', currentRow);
                    tile.setAttribute('data-col', j);

                    const tileInner = document.createElement('div');
                    tileInner.classList.add('guess-box-inner');

                    const tileFront = document.createElement('div');
                    tileFront.classList.add('guess-box-front');

                    const tileBack = document.createElement('div');
                    tileBack.classList.add('guess-box-back');

                    tileInner.appendChild(tileBack);
                    tileInner.appendChild(tileFront);
                    tile.appendChild(tileInner);
                    row.appendChild(tile);
                }
                grid.appendChild(row);

                void row.offsetWidth;
                row.classList.add('visible');

                grid.style.width = grid.scrollWidth + 'px';

                if (grid.scrollWidth > grid.parentElement.clientWidth) {
                    sideScroll(grid, "left", 25, 100, 5);
                }

                document.getElementById('game-curRow').textContent = currentRow + 1;
            }

            function handleEnter() {
                let rawguess = inputField.value.trim()
                    .replaceAll(' ', '')
                    .replaceAll('/', '／')
                    .replaceAll('(', '（')
                    .replaceAll(')', '）')
                    .replaceAll('台', '臺')
                    .replaceAll('口其', '唭')
                    .replaceAll('但金', '淡金')
                    .replaceAll('虫內', '蚋')
                    .replaceAll('加辣', '加蚋');

                if (rawguess.length === 0) return;

                if (Object.keys(replaceList).includes(rawguess))
                    rawguess = replaceList[rawguess];

                const guess = rawguess;

                inputField.value = "";
                inputField.dispatchEvent(new Event("input"))

                if (['放棄', '投降', '答案', '不知道', '不曉得'].includes(guess)) {
                    showMessage(targetWord);
                    controlInputs(targetWord);
                    document.getElementById('wordleBotOutputContainer').classList.remove('display-none');
                    return;
                }
                else if (userData['guess'][currentRow - 1] === "龍山寺" && guess === "天后宮") {
                    showMessage("雕刻精美唐山公");
                    return;
                }

                const paddedGuess = guess.padEnd(maxLength, ' ');

                if (!wordList.includes(guess)) {
                    if (!fullData[guess]) {
                        showMessage("查無此站");
                        return;
                    }

                    showMessage("不在所選範圍內");
                    return;
                }

                checkGuess(paddedGuess);
            }

            handleEnterButton = handleEnter;

            function checkGuess(guess) {
                inputField.focus();

                userData['guess'].push(guess.trim());
                isGameOver = guess.trim() === targetWord;
                isUselessGuess = !wordleBotList.includes(guess);

                const curRowDiv = document.querySelector(`#r${currentRow}`);
                const rowTiles = Array.from(grid.querySelectorAll(`.guess-box[data-row="${currentRow}"]`));
                const targetLetters = paddedTarget.split('');
                const guessLetters = guess.split('');
                let wordleBotFeedback = new Array(maxLength);

                wordleBotGuesses.textContent = "";

                rowTiles.forEach((tile, index) => {
                    tile.classList.remove('success', 'danger')

                    const letter = guessLetters[index];
                    tile.querySelector('.guess-box-back').textContent = letter;

                    if (verticalList.includes(letter)) {
                        tile.querySelector('.guess-box-back').classList.add('text-vertical');
                    }

                    if (letter === targetLetters[index]) {
                        tile.classList.add('success');
                        targetLetters[index] = null;

                        if (letter != " ") {
                            wordleBotList = wordleBotList.filter((word) => word.split("")[index] === letter);
                            // console.log(`保留「${letter}」於第 ${index + 1} 位者，賸餘 ${wordleBotList.length} 站`);
                        }
                    }
                });

                rowTiles.forEach((tile, index) => {
                    const letter = guessLetters[index];
                    const inTargetPos = targetLetters.indexOf(letter);

                    if (!tile.classList.contains('success') && targetLetters.includes(letter)) {
                        tile.classList.add('danger');
                        targetLetters[inTargetPos] = null;

                        if (letter != " ") {
                            wordleBotList = wordleBotList.filter((word) => word.split("").some((wordletter, i) => letter === wordletter && i != index));
                            // console.log(`保留含「${letter}」字且不在第 ${index + 1} 位者，賸餘 ${wordleBotList.length} 站`);
                        }
                    }
                    else if (!paddedTarget.split('').includes(letter) && letter != " ") {
                        wordleBotList = wordleBotList.filter((word) => !word.split("").some((wordletter, i) => letter === wordletter));
                        // console.log(`捨去含「${letter}」字者，賸餘 ${wordleBotList.length} 站`);
                    }

                    setTimeout(() => {
                        tile.classList.add('flip');
                    }, index * 100);
                });

                // setTimeout(() => {
                //     curRowDiv.classList.add('unfocus');
                // }, (maxLength + 1) * 100);

                const guessedLine = getLinesForStation(guess.trim());
                if (shareLine(guess.trim())) {
                    curRowDiv.classList.add('rightLine');
                    wordleBotList = wordleBotList.filter((word) => shareLine(word, guessedLine));
                    wordleBotLines = Array.from(guessedLine);
                    // console.log(`保留屬於「${guessedLine.join('、')}」者，賸餘 ${wordleBotList.length} 站`);
                }
                else {
                    wordleBotList = wordleBotList.filter((word) => !shareLine(word, guessedLine));
                    guessedLine.forEach(line => {
                        index = wordleBotLines.indexOf(line);
                        if (index > -1) {
                            wordleBotLines.splice(index, 1);
                        }
                    })
                    // console.log(`捨去屬於「${guessedLine.join('、')}」者，賸餘 ${wordleBotList.length} 站`);
                }

                if (wordleBotTargetLength === 0) {
                    if ((guess.trim().length === minLength && guess.trim().length <= targetWord.length) || (guess.trim().length < targetWord.length)) {
                        wordleBotTargetLength = targetWord.length;
                        wordleBotList = wordleBotList.filter((word) => word.trim().length === wordleBotTargetLength);
                        // console.log(`保留字數長為「${wordleBotTargetLength}」者，賸餘 ${wordleBotList.length} 站`);
                    }
                }

                wordleBotListDifferences = wordleBotTotalPossibleCount - wordleBotList.length;
                if (isUselessGuess) {
                    showMessage(`此站已被排除`);
                }
                else if (wordleBotListDifferences * 1.5 > wordleBotTotalPossibleCount && wordleBotTotalPossibleCount >= 100) {
                    showMessage(`摒除了<span class="hanLat">${wordleBotListDifferences}</span>站`);
                }
                else if (wordleBotListDifferences * 1.5 > wordleBotTotalPossibleCount && wordleBotTotalPossibleCount < 20 && wordleBotListDifferences > 1) {
                    showMessage(`範圍已縮小至<span class="hanLat">${wordleBotTotalPossibleCount - wordleBotListDifferences}</span>站`);
                }

                runAlgo();

                if (isGameOver) {
                    showMessage("恭喜");
                    // controlInputs();

                    setTimeout(() => {
                        loadConfetti();
                    }, (maxLength + 1) * 100);

                    // document.querySelector('.typeArea').style.display = "none";
                    controlInputs(targetWord);
                    document.getElementById('wordleBotOutputContainer').classList.remove('display-none');

                    return;
                }

                updateChances(userData['guess'].length + 1);

                currentRow++;

                if (currentRow >= maxAttempts) {
                    showMessage(targetWord);
                    controlInputs(targetWord);
                    document.getElementById('wordleBotOutputContainer').classList.remove('display-none');
                    return;
                }

                createGridNew();
            }

            function controlInputs(innerText = "") {
                inputField.placeholder = innerText;
                inputField.disabled = true;
                submitBtn.disabled = true;

                const chancesUsed = currentRow + 1 > maxAttempts ? 'X' : currentRow + 1;
                const chancesLeft = currentRow + 1 > maxAttempts ? 'X' : maxAttempts - chancesUsed;

                document.querySelector('#gameOverTab').classList.remove('display-none');
                document.querySelector('#gameOverTab tbody').innerHTML += `                        <tr>
                            <td><span class="hanLat hl-r">${minLength}</span>至<span class="hanLat hl-l">${maxLength}</span></td>
                            <td><span class="hanLat hl-r">${chancesUsed}</span>之<span class="hanLat hl-l">${maxAttempts}</span></td>
                            <td><span class="hanLat hl-r">${document.querySelectorAll('#selectedLines .btn-fill').length}</span>條</td>
                        </tr>`;
                labelChancesNormal.innerHTML = `第<span class="hanLat">${chancesUsed}</span>之<span class="hanLat">${maxAttempts}</span>次`;
                labelChancesAlt.innerHTML = '餘<span class="hanLat">' + chancesLeft + '</span>次';

                generateCanvas();
            }

            inputField.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleEnter();
                }
            });

            function loadConfetti() {
                if ((currentRow + 1) <= 3) {
                    const end = Date.now() + 2 * 1000;

                    (function frame() {
                        confetti({
                            particleCount: 2,
                            angle: randomInRange(50, 70),
                            spread: randomInRange(50, 60),
                            origin: { x: 0, y: randomInRange(0.4, 0.6) },
                        });

                        confetti({
                            particleCount: 2,
                            angle: randomInRange(110, 130),
                            spread: randomInRange(50, 60),
                            origin: { x: 1, y: randomInRange(0.4, 0.6) },
                        });

                        if (Date.now() < end) {
                            requestAnimationFrame(frame);
                        }
                    })();
                } else if ((currentRow + 1) <= 5) {
                    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

                    confetti(
                        Object.assign({}, defaults, {
                            particleCount: 50,
                            origin: { x: randomInRange(0.1, 0.3), y: randomInRange(0.6, 0.8) },
                        })
                    );
                    confetti(
                        Object.assign({}, defaults, {
                            particleCount: 50,
                            origin: { x: randomInRange(0.7, 0.9), y: randomInRange(0.6, 0.8) },
                        })
                    );
                    confetti(
                        Object.assign({}, defaults, {
                            particleCount: 100,
                            origin: { x: randomInRange(0, 0.2), y: randomInRange(0.1, 0.3) },
                        })
                    );
                    confetti(
                        Object.assign({}, defaults, {
                            particleCount: 100,
                            origin: { x: randomInRange(0.8, 1), y: randomInRange(0.1, 0.3) },
                        })
                    );
                } else {
                    confetti({
                        angle: 270,
                        spread: 400,
                        particleCount: 150,
                        origin: { x: 0.5, y: 0 },
                    });
                }
            }

            function generateCanvas() {
                const config = {
                    maxLength: maxLength,
                    attempts: Math.min(maxAttempts, currentRow + 1),
                    cellSize: 50,
                    cellMargin: 10,
                    scaleFactor: 3,
                    font: 'ZutekSans',
                    fontSize: 30,
                    titleFontSize: 32,
                    contextFontSize: 12,
                    safeMargin: 24,
                    verticalGap: 6,
                    horizontalGap: 12,
                    minWidth: 400
                };

                let gameBoardWords = [];
                let gameBoardDistribution = [];
                let gameBoardFilled = [];

                grid.querySelectorAll('.guess-row').forEach(row => {
                    gameBoardFilled.push(row.classList.contains('rightLine'));

                    let rowTiles = [];
                    let rowDistribution = [];
                    row.querySelectorAll('.guess-box').forEach(tile => {
                        rowTiles.push(tile.querySelector('.guess-box-back').textContent);
                        rowDistribution.push(tile.classList.contains('success') ? 2 : (tile.classList.contains('danger') ? 1 : 0));
                    });
                    gameBoardWords.push(rowTiles);
                    gameBoardDistribution.push(rowDistribution);
                });

                const style = window.getComputedStyle(document.body);
                const colours = [
                    style.getPropertyValue('--border').trim(),
                    style.getPropertyValue('--danger').trim(),
                    style.getPropertyValue('--success').trim()
                ]

                const bgColour = style.backgroundColor;

                const canvas = document.getElementById('gameCanvas');
                const ctx = canvas.getContext('2d');

                const totalWidth = (config.cellSize * config.attempts + config.horizontalGap * (config.attempts - 1));
                const totalHeight = (config.cellSize * config.maxLength + config.verticalGap * (config.maxLength - 1));
                const canvasWidth = totalWidth + config.safeMargin * 2;
                const canvasHeight = totalHeight + config.titleFontSize + config.contextFontSize * 3 + config.safeMargin * 4;

                const widthEmptySpace = config.minWidth - canvasWidth;

                canvas.width = (widthEmptySpace > 0 ? config.minWidth : canvasWidth) * config.scaleFactor;
                canvas.height = canvasHeight * config.scaleFactor;

                // Set background color
                ctx.fillStyle = bgColour;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                let globalY = (config.titleFontSize / 2 + config.safeMargin) * config.scaleFactor;

                // Add player label
                ctx.fillStyle = style.getPropertyValue('--title-color').trim();
                ctx.font = `bold ${config.titleFontSize * config.scaleFactor}px ${style.getPropertyValue('--title-font').trim()}`;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText("運 dle", canvas.width / 2, globalY);

                globalY += (config.titleFontSize + config.contextFontSize + config.safeMargin) / 2 * config.scaleFactor;

                // Add context label
                ctx.fillStyle = style.getPropertyValue('--color').trim();
                ctx.font = `${config.contextFontSize * config.scaleFactor}px ${style.getPropertyValue('--mono-font').trim()}`;
                ctx.textAlign = "center";
                ctx.textBaseline = "alphabetic";
                ctx.fillText(`W[${minLength},${maxLength}]; C(${currentRow + 1 > maxAttempts ? 'X' : currentRow + 1}/${maxAttempts}); L(${document.querySelectorAll('#selectedLines .btn-fill').length})`, canvas.width / 2, globalY);

                if (enableBot) {
                    globalY += (config.contextFontSize + config.safeMargin / 4) * config.scaleFactor;
                    ctx.fillText(`SKL(${scoreSkill.textContent}%); LCK(${scoreLuck.textContent}%)`, canvas.width / 2, globalY);
                }
                else {
                    globalY += config.contextFontSize / 2 * config.scaleFactor;
                }

                ctx.fillText(`https://zutek3134.taipei/zh-tw/lab/yundle/`, canvas.width / 2, canvas.height - config.safeMargin * config.scaleFactor);

                // Positioning for grid
                const startX = config.safeMargin + (widthEmptySpace > 0 ? widthEmptySpace / 2 : 0);
                const startY = config.safeMargin;

                // Loop through the game state to draw each cell
                for (let len = 0; len < config.maxLength; len++) {
                    for (let att = config.attempts - 1; att >= 0; att--) {
                        const letter = gameBoardWords[att][len];
                        const state = gameBoardDistribution[att][len];

                        const x = (startX + (config.attempts - att - 1) * (config.cellSize + config.horizontalGap)) * config.scaleFactor;
                        const y = globalY + (startY + len * (config.cellSize + config.verticalGap)) * config.scaleFactor;

                        let textFill = bgColour;

                        // Draw background color
                        if (gameBoardFilled[att]) {
                            ctx.fillStyle = colours[state];
                            ctx.fillRect(x, y, config.cellSize * config.scaleFactor, config.cellSize * config.scaleFactor);
                        } else {
                            ctx.strokeStyle = colours[state];
                            ctx.lineWidth = 2 * config.scaleFactor;
                            ctx.strokeRect(x, y, config.cellSize * config.scaleFactor, config.cellSize * config.scaleFactor);

                            textFill = colours[state];
                        }

                        // Draw the letter
                        ctx.fillStyle = textFill;
                        ctx.font = `bold ${config.fontSize * config.scaleFactor}px ${config.font}`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(
                            letter,
                            x + (config.cellSize * config.scaleFactor) / 2,
                            y + (config.cellSize * config.scaleFactor) / 2
                        );
                    }
                }

                const imageUrl = document.getElementById('gameCanvas').toDataURL("image/png");

                const shareImg = document.getElementById("shareImg");
                shareImg.src = imageUrl;
                shareImg.parentElement.href = imageUrl;
            }

            loadDictionary();
            // createGrid();
            createGridNew();
            grid.style.height = grid.scrollHeight + 10 + 'px';
        }

        setTimeout(function () {
            document.querySelectorAll('[data-tab-category]').forEach(initTabs);
        }, 100);

        const savedSettings = localStorage.getItem('wordleSettings');
        if (savedSettings) {
            const {
                maxLength,
                minLength,
                maxAttempts,
                selectedLines,
                enableHint,
                enableBot
            } = JSON.parse(savedSettings);

            document.querySelector('#maxWords').value = Math.min(maxLength, 6);
            document.querySelector('#minWords').value = Math.max(minLength, 2);
            document.querySelector('#maxAttempts').value = Math.min(Math.max(maxAttempts, 1), 12);

            let enabledLineCount = 0;

            document.querySelectorAll(`#selectedLines .btn`).forEach((element) => {
                if (selectedLines.includes(element.getAttribute('data-name'))) {
                    element.classList.add('btn-fill');
                    enabledLineCount++;
                } else {
                    element.classList.remove('btn-fill');
                }
            });

            document.querySelector('#chosenCount').textContent = enabledLineCount;

            document.querySelector('#inputHint').checked = enableHint;

            if (enableBot)
                document.querySelector('#wordleBotButton').classList.add('btn-fill');
        }

        openModal('gameSettings');

        function sideScroll(element, direction, speed, distance, step) {
            scrollAmount = 0;
            var slideTimer = setInterval(function () {
                if (direction == 'left') {
                    element.scrollLeft -= step;
                } else {
                    element.scrollLeft += step;
                }
                scrollAmount += step;
                if (scrollAmount >= distance) {
                    window.clearInterval(slideTimer);
                }
            }, speed);
        }
    </script>
</body>

</html>